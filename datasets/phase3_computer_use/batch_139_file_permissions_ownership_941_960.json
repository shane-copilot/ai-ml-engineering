[
  {
    "id": "scenario_file_permissions_ownership_142",
    "command": "chmod",
    "scenario": "Manage file permissions and ownership - read, write, execute permissions for users, groups, and others.",
    "problem": "Need to control who can read, modify, or execute files, set proper permissions for scripts and directories, change file ownership, understand symbolic and numeric permission modes, fix permission issues, and secure sensitive files.",
    "solution": "Master chmod for permission changes (symbolic and octal notation), chown for ownership, chgrp for group ownership, understand permission bits (rwx), use umask for default permissions, and apply appropriate security practices.",
    "steps": [
      "USER SAYS: 'How do I control who can access my files? I need to make scripts executable, restrict access to sensitive files, and understand what those permission numbers like 644 and 755 mean.'",
      "AGENT: 'Let me teach you file permissions! We'll cover chmod, chown, understand rwx permissions, learn octal notation (755, 644), and secure your files properly.'",
      "AGENT: ''",
      "AGENT: '🔍 RESEARCH PHASE: File permissions and ownership...'",
      "AGENT: '[Searching] \"chmod chown file permissions rwx 755 644 umask\"'",
      "AGENT: '[Found] Permissions: read (r), write (w), execute (x).'",
      "AGENT: '[Found] Three sets: owner, group, others.'",
      "AGENT: '[Found] Numeric: 4=read, 2=write, 1=execute.'",
      "AGENT: '[Found] chmod changes permissions, chown changes owner.'",
      "AGENT: '✓ Research complete! Let's master permissions.'",
      "AGENT: ''",
      "AGENT: '--- Approach 1: Understanding Permission Display ---'",
      "Create tool: `touch testfile.txt`",
      "Run command: `ls -l testfile.txt`",
      "AGENT: '-rw-r--r-- 1 user user 0 Oct  8 10:00 testfile.txt'",
      "AGENT: '│└─┬──┘└┬─┘└┬─┘'",
      "AGENT: '│  │    │   │'",
      "AGENT: '│  │    │   └── Others permissions'",
      "AGENT: '│  │    └────── Group permissions'",
      "AGENT: '│  └─────────── Owner permissions'",
      "AGENT: '└────────────── File type'",
      "AGENT: ''",
      "AGENT: 'Permission breakdown:'",
      "AGENT: '  -  = Regular file (d=directory, l=link)'",
      "AGENT: '  rw- = Owner can read, write'",
      "AGENT: '  r-- = Group can read only'",
      "AGENT: '  r-- = Others can read only'",
      "AGENT: ''",
      "Create tool: `mkdir testdir`",
      "Run command: `ls -ld testdir`",
      "AGENT: 'drwxr-xr-x 2 user user 4096 Oct  8 10:00 testdir'",
      "AGENT: 'd = Directory'",
      "AGENT: ''",
      "AGENT: '--- Approach 2: Symbolic Chmod (Letters) ---'",
      "Run command: `chmod u+x testfile.txt`",
      "AGENT: '  u = User/owner'",
      "AGENT: '  + = Add permission'",
      "AGENT: '  x = Execute'",
      "AGENT: 'Adds execute permission for owner'",
      "AGENT: ''",
      "Run command: `ls -l testfile.txt`",
      "AGENT: '-rwxr--r-- 1 user user 0 Oct  8 10:00 testfile.txt'",
      "AGENT: '   ↑ Now executable by owner'",
      "AGENT: ''",
      "Run command: `chmod g+w testfile.txt`",
      "AGENT: '  g = Group'",
      "AGENT: 'Adds write permission for group'",
      "AGENT: ''",
      "Run command: `chmod o-r testfile.txt`",
      "AGENT: '  o = Others'",
      "AGENT: '  - = Remove permission'",
      "AGENT: 'Removes read permission for others'",
      "AGENT: ''",
      "Run command: `chmod a+r testfile.txt`",
      "AGENT: '  a = All (user, group, others)'",
      "AGENT: 'Adds read for everyone'",
      "AGENT: ''",
      "Run command: `chmod u+rw,g+r,o-rwx testfile.txt`",
      "AGENT: 'Multiple changes at once'",
      "AGENT: ''",
      "AGENT: '--- Approach 3: Numeric Chmod (Octal) ---'",
      "AGENT: ''",
      "AGENT: 'Permission values:'",
      "AGENT: '  r (read)    = 4'",
      "AGENT: '  w (write)   = 2'",
      "AGENT: '  x (execute) = 1'",
      "AGENT: '  - (none)    = 0'",
      "AGENT: ''",
      "AGENT: 'Add them up:'",
      "AGENT: '  rwx = 4+2+1 = 7'",
      "AGENT: '  rw- = 4+2+0 = 6'",
      "AGENT: '  r-x = 4+0+1 = 5'",
      "AGENT: '  r-- = 4+0+0 = 4'",
      "AGENT: '  --- = 0+0+0 = 0'",
      "AGENT: ''",
      "Run command: `chmod 644 testfile.txt`",
      "AGENT: '  6 = rw- (owner)'",
      "AGENT: '  4 = r-- (group)'",
      "AGENT: '  4 = r-- (others)'",
      "AGENT: ''",
      "Run command: `ls -l testfile.txt`",
      "AGENT: '-rw-r--r-- 1 user user 0 Oct  8 10:00 testfile.txt'",
      "AGENT: ''",
      "Run command: `chmod 755 testfile.txt`",
      "AGENT: '  7 = rwx (owner can read, write, execute)'",
      "AGENT: '  5 = r-x (group can read, execute)'",
      "AGENT: '  5 = r-x (others can read, execute)'",
      "AGENT: ''",
      "Run command: `ls -l testfile.txt`",
      "AGENT: '-rwxr-xr-x 1 user user 0 Oct  8 10:00 testfile.txt'",
      "AGENT: ''",
      "AGENT: '--- Approach 4: Common Permission Patterns ---'",
      "AGENT: ''",
      "AGENT: '644 = rw-r--r--  (Default files)'",
      "AGENT: '  • Owner can edit'",
      "AGENT: '  • Others can read'",
      "AGENT: '  • Good for documents, configs'",
      "AGENT: ''",
      "AGENT: '755 = rwxr-xr-x  (Executable files, directories)'",
      "AGENT: '  • Owner can modify and run'",
      "AGENT: '  • Others can read and run'",
      "AGENT: '  • Good for scripts, binaries, directories'",
      "AGENT: ''",
      "AGENT: '600 = rw-------  (Private files)'",
      "AGENT: '  • Only owner can read/write'",
      "AGENT: '  • Good for SSH keys, passwords'",
      "AGENT: ''",
      "AGENT: '700 = rwx------  (Private executable)'",
      "AGENT: '  • Only owner can access'",
      "AGENT: '  • Good for personal scripts'",
      "AGENT: ''",
      "AGENT: '666 = rw-rw-rw-  (Everyone can edit)'",
      "AGENT: '  • ⚠️ Insecure! Rarely used'",
      "AGENT: ''",
      "AGENT: '777 = rwxrwxrwx  (Everyone full access)'",
      "AGENT: '  • ⚠️ Very insecure! Never use in production'",
      "AGENT: ''",
      "AGENT: '--- Approach 5: Make Script Executable ---'",
      "Create tool: `cat > script.sh << 'EOF'`",
      "#!/bin/bash\necho \"Hello, World!\"\nEOF",
      "AGENT: ''",
      "Run command: `ls -l script.sh`",
      "AGENT: '-rw-r--r-- 1 user user 31 Oct  8 10:00 script.sh'",
      "AGENT: 'Not executable yet'",
      "AGENT: ''",
      "Run command: `./script.sh`",
      "AGENT: 'bash: ./script.sh: Permission denied'",
      "AGENT: ''",
      "Run command: `chmod +x script.sh`",
      "AGENT: 'Makes executable for everyone'",
      "AGENT: ''",
      "Run command: `ls -l script.sh`",
      "AGENT: '-rwxr-xr-x 1 user user 31 Oct  8 10:00 script.sh'",
      "AGENT: ''",
      "Run command: `./script.sh`",
      "AGENT: 'Hello, World!'",
      "AGENT: '✓ Script now runs!'",
      "AGENT: ''",
      "AGENT: 'Or use numeric:'",
      "Run command: `chmod 755 script.sh`",
      "AGENT: 'Same result'",
      "AGENT: ''",
      "AGENT: '--- Approach 6: Directory Permissions ---'",
      "Run command: `mkdir mydir`",
      "Run command: `chmod 755 mydir`",
      "AGENT: 'Standard directory permissions'",
      "AGENT: ''",
      "AGENT: 'Directory permission meanings:'",
      "AGENT: '  r = List contents (ls)'",
      "AGENT: '  w = Create/delete files'",
      "AGENT: '  x = Enter directory (cd)'",
      "AGENT: ''",
      "Run command: `chmod 644 mydir`",
      "AGENT: 'Makes directory broken!'",
      "Run command: `cd mydir`",
      "AGENT: 'bash: cd: mydir: Permission denied'",
      "AGENT: '⚠️ Directories need x to be usable'",
      "AGENT: ''",
      "Run command: `chmod 755 mydir`",
      "AGENT: 'Fixed!'",
      "AGENT: ''",
      "AGENT: '--- Approach 7: Recursive Permission Changes ---'",
      "Create tool: `mkdir -p project/{src,docs,bin}`",
      "Create tool: `touch project/src/main.c project/docs/README.md`",
      "AGENT: ''",
      "Run command: `chmod -R 755 project/`",
      "AGENT: '  -R = Recursive (all files and subdirectories)'",
      "AGENT: '✓ Sets 755 on everything'",
      "AGENT: ''",
      "AGENT: 'Better approach (different perms for files vs dirs):'",
      "Run command: `find project -type d -exec chmod 755 {} \\;`",
      "AGENT: 'Sets 755 on directories only'",
      "AGENT: ''",
      "Run command: `find project -type f -exec chmod 644 {} \\;`",
      "AGENT: 'Sets 644 on files only'",
      "AGENT: ''",
      "AGENT: '--- Approach 8: Change Ownership ---'",
      "Run command: `ls -l testfile.txt`",
      "AGENT: '-rw-r--r-- 1 user user 0 Oct  8 10:00 testfile.txt'",
      "AGENT: '              └──┘ └──┘'",
      "AGENT: '             owner group'",
      "AGENT: ''",
      "Run command: `sudo chown alice testfile.txt`",
      "AGENT: 'Changes owner to alice'",
      "AGENT: ''",
      "Run command: `sudo chown alice:developers testfile.txt`",
      "AGENT: 'Changes owner to alice and group to developers'",
      "AGENT: ''",
      "Run command: `sudo chown :developers testfile.txt`",
      "AGENT: 'Changes only group'",
      "AGENT: ''",
      "Run command: `sudo chgrp developers testfile.txt`",
      "AGENT: 'Alternative way to change group'",
      "AGENT: ''",
      "Run command: `sudo chown -R alice:developers project/`",
      "AGENT: '  -R = Recursive'",
      "AGENT: ''",
      "AGENT: '--- Approach 9: Special Permissions ---'",
      "AGENT: ''",
      "AGENT: 'SUID (Set User ID) - 4xxx:'",
      "Run command: `chmod 4755 script.sh`",
      "Run command: `ls -l script.sh`",
      "AGENT: '-rwsr-xr-x 1 root root 100 Oct  8 10:00 script.sh'",
      "AGENT: '   ↑ s instead of x = SUID bit'",
      "AGENT: 'Script runs with owner\\'s permissions (dangerous!)'",
      "AGENT: ''",
      "AGENT: 'SGID (Set Group ID) - 2xxx:'",
      "Run command: `chmod 2755 mydir`",
      "Run command: `ls -ld mydir`",
      "AGENT: 'drwxr-sr-x 2 user group 4096 Oct  8 10:00 mydir'",
      "AGENT: '      ↑ s instead of x = SGID bit'",
      "AGENT: 'Files created in dir inherit group'",
      "AGENT: ''",
      "AGENT: 'Sticky Bit - 1xxx:'",
      "Run command: `chmod 1777 /tmp`",
      "Run command: `ls -ld /tmp`",
      "AGENT: 'drwxrwxrwt 10 root root 4096 Oct  8 10:00 /tmp'",
      "AGENT: '        ↑ t instead of x = Sticky bit'",
      "AGENT: 'Only file owner can delete their files'",
      "AGENT: '(Used in /tmp and other shared directories)'",
      "AGENT: ''",
      "AGENT: '--- Approach 10: Default Permissions (umask) ---'",
      "Run command: `umask`",
      "AGENT: '0022'",
      "AGENT: ''",
      "AGENT: 'umask subtracts from defaults:'",
      "AGENT: '  Files default:      666 (rw-rw-rw-)'",
      "AGENT: '  Minus umask:      - 022 (----w--w-)'",
      "AGENT: '  Result:             644 (rw-r--r--)'",
      "AGENT: ''",
      "AGENT: '  Dirs default:       777 (rwxrwxrwx)'",
      "AGENT: '  Minus umask:      - 022 (----w--w-)'",
      "AGENT: '  Result:             755 (rwxr-xr-x)'",
      "AGENT: ''",
      "Run command: `umask 077`",
      "AGENT: 'More restrictive: new files get 600, dirs get 700'",
      "AGENT: ''",
      "Run command: `touch newfile.txt`",
      "Run command: `ls -l newfile.txt`",
      "AGENT: '-rw------- 1 user user 0 Oct  8 10:00 newfile.txt'",
      "AGENT: ''",
      "AGENT: 'Set in ~/.bashrc for permanent:'",
      "AGENT: 'umask 022'",
      "AGENT: ''",
      "AGENT: '--- Bonus: Permission Fixing Script ---'",
      "Create tool: `cat > fix-permissions.sh << 'EOF'`",
      "#!/bin/bash\nset -euo pipefail\n\nDIR=\"${1:-.}\"\n\necho \"Fixing permissions in: $DIR\"\necho \"\"\n\n# Fix directory permissions: 755 (rwxr-xr-x)\necho \"Setting directories to 755...\"\nfind \"$DIR\" -type d -exec chmod 755 {} \\;\n\n# Fix file permissions: 644 (rw-r--r--)\necho \"Setting files to 644...\"\nfind \"$DIR\" -type f -exec chmod 644 {} \\;\n\n# Make scripts executable: 755\necho \"Making scripts executable...\"\nfind \"$DIR\" -type f \\( -name \"*.sh\" -o -name \"*.py\" -o -name \"*.pl\" \\) -exec chmod 755 {} \\;\n\n# Fix ownership (if run as root)\nif [ \"$(id -u)\" -eq 0 ]; then\n    OWNER=\"${2:-$SUDO_USER}\"\n    if [ -n \"$OWNER\" ]; then\n        echo \"Setting owner to: $OWNER\"\n        chown -R \"$OWNER:$OWNER\" \"$DIR\"\n    fi\nfi\n\necho \"\"\necho \"✓ Permissions fixed!\"\nEOF",
      "Run command: `chmod +x fix-permissions.sh`",
      "Run command: `./fix-permissions.sh /var/www/html`",
      "AGENT: 'Fixing permissions in: /var/www/html'",
      "AGENT: 'Setting directories to 755...'",
      "AGENT: 'Setting files to 644...'",
      "AGENT: 'Making scripts executable...'",
      "AGENT: '✓ Permissions fixed!'",
      "AGENT: ''",
      "AGENT: '--- Bonus: Permission Reference ---'",
      "AGENT: ''",
      "AGENT: 'SYMBOLIC:'",
      "AGENT: '  u = user/owner'",
      "AGENT: '  g = group'",
      "AGENT: '  o = others'",
      "AGENT: '  a = all'",
      "AGENT: '  + = add permission'",
      "AGENT: '  - = remove permission'",
      "AGENT: '  = = set exact permission'",
      "AGENT: ''",
      "AGENT: 'NUMERIC:'",
      "AGENT: '  4 = read (r)'",
      "AGENT: '  2 = write (w)'",
      "AGENT: '  1 = execute (x)'",
      "AGENT: ''",
      "AGENT: 'COMMON PATTERNS:'",
      "AGENT: '  644  Regular files'",
      "AGENT: '  755  Directories, executables'",
      "AGENT: '  600  Private files (keys)'",
      "AGENT: '  700  Private directories'",
      "AGENT: '  777  ⚠️ Insecure (everyone)'",
      "AGENT: ''",
      "AGENT: '✓ SOLUTION SUMMARY:'",
      "AGENT: '  ✓ Understood permission display: owner, group, others.'",
      "AGENT: '  ✓ Changed permissions with chmod (symbolic and numeric).'",
      "AGENT: '  ✓ Learned octal notation: 644, 755, 600, 700.'",
      "AGENT: '  ✓ Made scripts executable with chmod +x or 755.'",
      "AGENT: '  ✓ Set directory permissions properly (need x bit).'",
      "AGENT: '  ✓ Applied recursive permissions with -R.'",
      "AGENT: '  ✓ Changed ownership with chown and chgrp.'",
      "AGENT: '  ✓ Understood special permissions: SUID, SGID, sticky bit.'",
      "AGENT: '  ✓ Configured default permissions with umask.'",
      "AGENT: '  ✓ Created permission fixing automation script.'",
      "AGENT: '  ✓ You now master Linux file permissions! 🔒'"
    ],
    "commands": ["chmod", "chown", "chgrp", "umask", "ls"],
    "packages": {
      "debian_ubuntu": ["coreutils"],
      "arch": ["coreutils"]
    },
    "related_commands": ["stat", "getfacl", "setfacl"],
    "complexity": "beginner",
    "tags": ["chmod", "chown", "permissions", "ownership", "security", "rwx", "octal", "umask", "file-security"]
  }
]

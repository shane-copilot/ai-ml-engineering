[
  {
    "id": "hw_001",
    "scenario": "USB device not recognized or keeps disconnecting",
    "problem": "USB device shows as connected physically but doesn't appear in system or randomly disconnects",
    "solution": "Diagnose USB stack from hardware to kernel driver to udev rules",
    "steps": [
      "Check if device is detected at all: lsusb - should list all USB devices",
      "Watch for connect/disconnect events: sudo dmesg -w then plug/unplug device",
      "Check USB controller: lspci | grep -i usb",
      "Verify device power draw isn't exceeding USB limits: lsusb -v | grep -E 'Bus|MaxPower' - USB2=500mA, USB3=900mA",
      "Try different USB port: USB 2.0 vs 3.0, motherboard vs hub",
      "Check for errors in kernel log: dmesg | grep -i 'usb\\|reset\\|device descriptor'",
      "See if device appears then disappears: watch -n 0.5 lsusb",
      "Check USB autosuspend: cat /sys/module/usbcore/parameters/autosuspend",
      "Disable USB autosuspend: echo -1 | sudo tee /sys/module/usbcore/parameters/autosuspend",
      "Make permanent in GRUB: sudo nano /etc/default/grub - add usbcore.autosuspend=-1 to GRUB_CMDLINE_LINUX",
      "Update GRUB: sudo update-grub (Ubuntu) or sudo grub-mkconfig -o /boot/grub/grub.cfg (Arch)",
      "Check for driver issues: sudo modprobe -r <driver> && sudo modprobe <driver>",
      "Look for module blacklisting: cat /etc/modprobe.d/* | grep blacklist",
      "Test with different cable: Bad cable is common cause",
      "Check USB hub power: If using hub, try powered hub instead of bus-powered",
      "Verify filesystem on USB drive: sudo fsck.ext4 -f /dev/sdX1 or sudo ntfsfix /dev/sdX1",
      "Check device permissions: ls -l /dev/bus/usb/*/* - should have proper perms or udev rules",
      "Add udev rule if needed: sudo nano /etc/udev/rules.d/99-usb.rules - SUBSYSTEM==\"usb\", ATTR{idVendor}==\"xxxx\", MODE=\"0666\"",
      "Reload udev rules: sudo udevadm control --reload && sudo udevadm trigger",
      "Check for USB controller errors: sudo lspci -vvv | grep -A 10 USB",
      "Update USB controller firmware if available (check motherboard manufacturer)",
      "Try kernel parameter: Add usbhid.quirks=0xVVVV:0xPPPP:0x0004 to GRUB config"
    ],
    "commands": ["lsusb", "dmesg", "lspci", "modprobe", "fsck", "ntfsfix", "ls", "udevadm", "update-grub", "grub-mkconfig"],
    "packages": {
      "debian_ubuntu": ["usbutils", "pciutils", "e2fsprogs", "ntfs-3g", "udev"],
      "arch": ["usbutils", "pciutils", "e2fsprogs", "ntfs-3g", "udev"]
    },
    "complexity": "intermediate",
    "tags": ["usb", "hardware", "troubleshooting", "device-detection", "udev"]
  },
  {
    "id": "hw_002",
    "scenario": "Laptop running extremely hot and fans at maximum speed constantly",
    "problem": "System temperatures in 80-90°C range during normal use, fans screaming, potential thermal throttling",
    "solution": "Diagnose thermal issues, clean cooling system, optimize power management and fan control",
    "steps": [
      "Check current temperatures: sensors (from lm-sensors package)",
      "Install sensors if needed: sudo apt install lm-sensors && sudo sensors-detect (Ubuntu) or sudo pacman -S lm_sensors && sudo sensors-detect (Arch)",
      "Monitor temps in real-time: watch -n 1 sensors",
      "Check CPU frequency scaling: cat /sys/devices/system/cpu/cpu*/cpufreq/scaling_cur_freq",
      "Verify thermal throttling: dmesg | grep -i 'thermal\\|critical\\|throttle'",
      "Check which component is hottest: sensors | grep -E 'Core|temp|fan'",
      "Monitor power consumption: sudo powertop or sudo turbostat",
      "Check for dust in vents: Physical inspection, compressed air cleaning",
      "Verify fan is spinning: sensors | grep fan or physical inspection",
      "Test stress: stress-ng --cpu 4 --timeout 60s --metrics-brief && watch sensors",
      "Optimize CPU governor: echo powersave | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor",
      "Limit max CPU frequency: echo 2000000 | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_max_freq (2GHz)",
      "Install TLP for power management: sudo apt install tlp (Ubuntu) or sudo pacman -S tlp (Arch)",
      "Configure TLP: sudo tlp start && sudo tlp-stat",
      "Disable turbo boost: echo 1 | sudo tee /sys/devices/system/cpu/intel_pstate/no_turbo",
      "Repaste thermal compound if laptop is old: Requires disassembly",
      "Undervolt CPU with intel-undervolt: sudo pacman -S intel-undervolt && sudo systemctl enable --now intel-undervolt",
      "Configure fan control with fancontrol: sudo pwmconfig then sudo systemctl enable --now fancontrol",
      "Check for BIOS updates: Manufacturers sometimes fix thermal issues in BIOS updates",
      "Use laptop cooling pad: External active cooling solution",
      "Check for background processes: top - sort by CPU, kill unnecessary processes",
      "Disable dedicated GPU if not needed: sudo prime-select intel (Ubuntu with Nvidia) or bbswitch for manual control",
      "Monitor long-term: sensors | tee -a /var/log/temps.log"
    ],
    "commands": ["sensors", "dmesg", "cat", "powertop", "turbostat", "stress-ng", "echo", "tee", "systemctl", "top"],
    "packages": {
      "debian_ubuntu": ["lm-sensors", "powertop", "linux-tools-generic", "stress-ng", "tlp", "intel-undervolt", "fancontrol"],
      "arch": ["lm_sensors", "powertop", "turbostat", "stress", "tlp", "intel-undervolt", "lm_sensors"]
    },
    "complexity": "advanced",
    "tags": ["thermal", "overheating", "cooling", "power-management", "hardware", "laptop"]
  },
  {
    "id": "hw_003",
    "scenario": "External monitor not detected on laptop",
    "problem": "Connected external monitor via HDMI/DisplayPort but system doesn't detect it",
    "solution": "Diagnose display outputs, GPU state, and display server configuration",
    "steps": [
      "Check connected displays: xrandr --listmonitors or xrandr | grep connected",
      "See all outputs: xrandr --query or xrandr | grep -E 'connected|disconnected'",
      "Force detection: xrandr --auto",
      "Check cable and port: Try different cable, different port on laptop/monitor",
      "Verify monitor is powered on and set to correct input source",
      "Check GPU driver: lspci -k | grep -A 3 VGA",
      "For Intel graphics: Check i915 module loaded: lsmod | grep i915",
      "For Nvidia: Check driver: nvidia-smi or lsmod | grep nvidia",
      "For AMD: Check amdgpu module: lsmod | grep amdgpu",
      "Check kernel messages: dmesg | grep -i 'drm\\|hdmi\\|display'",
      "Try different resolution: xrandr --output HDMI-1 --mode 1920x1080",
      "Enable output if disabled: xrandr --output HDMI-1 --auto",
      "For laptop with hybrid graphics: Check which GPU is active: prime-select query or glxinfo | grep 'OpenGL renderer'",
      "Switch to discrete GPU: sudo prime-select nvidia (Ubuntu) or optimus-manager --switch nvidia (Arch)",
      "Check display server: echo $XDG_SESSION_TYPE - X11 or Wayland",
      "Try under X11 if on Wayland: Log out, select X11 session from login screen",
      "For Wayland, check outputs: wlr-randr (wlroots compositors)",
      "Verify EDID data: sudo get-edid | parse-edid",
      "Force EDID if detection fails: xrandr --newmode <mode> && xrandr --addmode HDMI-1 <mode>",
      "Check for xorg.conf issues: cat /etc/X11/xorg.conf or /usr/share/X11/xorg.conf.d/*",
      "Generate new xorg.conf: sudo X -configure or sudo nvidia-xconfig (Nvidia)",
      "Update GPU drivers: sudo apt update && sudo apt install --reinstall xserver-xorg-video-<driver> (Ubuntu)",
      "For Arch: sudo pacman -S xf86-video-intel (Intel) or nvidia (Nvidia) or xf86-video-amdgpu (AMD)",
      "Check display manager settings: Settings → Displays in GNOME/KDE",
      "Try from terminal: DISPLAY=:0 xrandr --output HDMI-1 --auto",
      "Reboot with monitor connected: Sometimes helps with detection"
    ],
    "commands": ["xrandr", "lspci", "lsmod", "dmesg", "nvidia-smi", "prime-select", "glxinfo", "wlr-randr", "get-edid", "parse-edid", "X"],
    "packages": {
      "debian_ubuntu": ["x11-xserver-utils", "mesa-utils", "read-edid", "nvidia-prime"],
      "arch": ["xorg-xrandr", "mesa-utils", "read-edid", "nvidia-prime"]
    },
    "complexity": "intermediate",
    "tags": ["display", "monitor", "hdmi", "xrandr", "gpu", "hardware", "troubleshooting"]
  },
  {
    "id": "hw_004",
    "scenario": "Audio not working or wrong device selected",
    "problem": "No sound output, or sound going to wrong device (speakers instead of headphones, etc.)",
    "solution": "Navigate the Linux audio stack: ALSA → PulseAudio/PipeWire → applications",
    "steps": [
      "Check if sound card detected: aplay -l (ALSA devices) or pactl list cards (PulseAudio)",
      "List all sound outputs: pactl list sinks or pactl list sinks short",
      "List all sound inputs: pactl list sources or pactl list sources short",
      "Check default sink: pactl info | grep 'Default Sink'",
      "Set correct default sink: pactl set-default-sink <sink-name>",
      "Test audio output: speaker-test -t wav -c 2 (ALSA) or paplay /usr/share/sounds/alsa/Front_Center.wav",
      "Check volume levels: alsamixer (press F6 to select card, M to unmute)",
      "Unmute in ALSA: amixer sset Master unmute && amixer sset Speaker unmute && amixer sset Headphone unmute",
      "Check PulseAudio status: pulseaudio --check -v or systemctl --user status pulseaudio",
      "Restart PulseAudio: pulseaudio -k && pulseaudio --start",
      "For PipeWire: systemctl --user restart pipewire pipewire-pulse",
      "Check application output: pactl list sink-inputs - shows which apps are playing audio",
      "Move application to different sink: pactl move-sink-input <input-id> <sink-id>",
      "Check if muted in application: pavucontrol (GUI volume control)",
      "Verify kernel driver: lsmod | grep snd && dmesg | grep snd",
      "Check for HDMI audio conflict: Sometimes HDMI audio device becomes default",
      "Disable HDMI audio if not needed: Edit /etc/modprobe.d/alsa-base.conf, add options snd_hda_intel enable=1,0",
      "Check for conflicts: fuser -v /dev/snd/* (shows what's using audio devices)",
      "Verify user in audio group: groups $USER | grep audio - add if missing: sudo usermod -aG audio $USER",
      "Check ALSA configuration: cat ~/.asoundrc or /etc/asound.conf",
      "Reset PulseAudio config: rm -rf ~/.config/pulse && pulseaudio -k",
      "Check for JACK interference: ps aux | grep jack",
      "Update ALSA firmware: sudo alsa force-reload",
      "For Bluetooth audio: bluetoothctl connect <device-mac> && pactl list cards | grep blue",
      "Check codec support: cat /proc/asound/card*/codec* | grep -i codec"
    ],
    "commands": ["aplay", "pactl", "speaker-test", "paplay", "alsamixer", "amixer", "pulseaudio", "systemctl", "pavucontrol", "lsmod", "dmesg", "fuser", "groups", "usermod", "bluetoothctl"],
    "packages": {
      "debian_ubuntu": ["alsa-utils", "pulseaudio", "pulseaudio-utils", "pavucontrol", "pipewire", "pipewire-pulse"],
      "arch": ["alsa-utils", "pulseaudio", "pulseaudio-alsa", "pavucontrol", "pipewire", "pipewire-pulse"]
    },
    "complexity": "intermediate",
    "tags": ["audio", "sound", "alsa", "pulseaudio", "pipewire", "hardware", "troubleshooting"]
  },
  {
    "id": "hw_005",
    "scenario": "Laptop battery draining extremely fast",
    "problem": "Battery that used to last 6 hours now only lasts 1-2 hours on same usage",
    "solution": "Diagnose power consumption, optimize power management, check battery health",
    "steps": [
      "Check battery health: upower -i /org/freedesktop/UPower/devices/battery_BAT0 or cat /sys/class/power_supply/BAT0/capacity",
      "See current power draw: sudo powertop - shows current watts and what's consuming",
      "Check battery capacity: cat /sys/class/power_supply/BAT0/energy_full vs energy_full_design",
      "Calculate health percentage: (energy_full / energy_full_design) * 100",
      "Monitor discharge rate: watch -n 2 'cat /sys/class/power_supply/BAT0/power_now' (µW)",
      "Find power-hungry processes: sudo powertop (press Tab to see processes)",
      "Install TLP: sudo apt install tlp tlp-rdw (Ubuntu) or sudo pacman -S tlp (Arch)",
      "Enable TLP: sudo systemctl enable --now tlp",
      "Check TLP status: sudo tlp-stat -b (battery) and sudo tlp-stat -p (processor)",
      "Configure TLP: sudo nano /etc/tlp.conf - adjust CPU_SCALING_GOVERNOR, PCIE_ASPM, etc.",
      "Disable wake-on-lan: ethtool eth0 | grep Wake-on && sudo ethtool -s eth0 wol d",
      "Check for USB devices draining power: lsusb && cat /sys/bus/usb/devices/*/power/control",
      "Enable USB autosuspend: for i in /sys/bus/usb/devices/*/power/control; do echo auto | sudo tee $i; done",
      "Reduce screen brightness: xbacklight -set 50 or echo 50 | sudo tee /sys/class/backlight/*/brightness",
      "Disable keyboard backlight: echo 0 | sudo tee /sys/class/leds/*/brightness",
      "Check for runaway processes: top - sort by CPU and memory",
      "Disable Bluetooth if not needed: rfkill block bluetooth",
      "Disable WiFi if using ethernet: rfkill block wifi or nmcli radio wifi off",
      "Check for GPU activity: nvidia-smi (Nvidia) or radeontop (AMD) or intel_gpu_top (Intel)",
      "Force integrated GPU: sudo prime-select intel (if have discrete GPU)",
      "Disable file indexing: systemctl --user mask tracker-store.service tracker-miner-fs.service",
      "Check systemd services: systemctl list-units --type=service --state=running",
      "Calibrate battery: Fully charge, then discharge completely, then fully charge again",
      "Check for BIOS updates: May include power management improvements",
      "Consider battery replacement if health <80% and laptop is old"
    ],
    "commands": ["upower", "cat", "powertop", "watch", "systemctl", "tlp-stat", "ethtool", "lsusb", "xbacklight", "echo", "tee", "top", "rfkill", "nmcli", "nvidia-smi", "radeontop", "intel_gpu_top", "prime-select"],
    "packages": {
      "debian_ubuntu": ["upower", "powertop", "tlp", "tlp-rdw", "ethtool", "x11-xserver-utils"],
      "arch": ["upower", "powertop", "tlp", "ethtool", "xorg-xbacklight"]
    },
    "complexity": "intermediate",
    "tags": ["battery", "power-management", "laptop", "tlp", "optimization", "hardware"]
  }
]

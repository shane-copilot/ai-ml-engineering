[
  {
    "id": "scenario_user_group_management_141",
    "command": "useradd",
    "scenario": "Manage users and groups - create, modify, delete users, manage permissions and access control.",
    "problem": "Need to create user accounts for team members, set up groups for department access, manage user passwords, control sudo access, set home directories, configure user shells, and handle user account lifecycle (creation, modification, deletion).",
    "solution": "Use useradd/adduser to create users, usermod to modify accounts, userdel to remove users, groupadd for groups, passwd for passwords, and understand /etc/passwd, /etc/shadow, /etc/group files for proper user management.",
    "steps": [
      "USER SAYS: 'I need to create user accounts for my team, set up groups for different projects, give some users sudo access, and manage passwords. How do I do all this properly?'",
      "AGENT: 'Let me show you complete user and group management! We'll create users, manage groups, set permissions, configure sudo, and handle the full user lifecycle.'",
      "AGENT: ''",
      "AGENT: 'ðŸ” RESEARCH PHASE: User and group management...'",
      "AGENT: '[Searching] \"useradd usermod userdel groupadd passwd sudo linux user management\"'",
      "AGENT: '[Found] useradd creates users, usermod modifies, userdel deletes.'",
      "AGENT: '[Found] groupadd creates groups, usermod -aG adds user to group.'",
      "AGENT: '[Found] passwd changes passwords, visudo configures sudo.'",
      "AGENT: '[Found] User info in /etc/passwd, passwords in /etc/shadow.'",
      "AGENT: 'âœ“ Research complete! Let's manage users and groups.'",
      "AGENT: ''",
      "AGENT: '--- Approach 1: Create New User (Basic) ---'",
      "Run command: `sudo useradd john`",
      "AGENT: 'Creates user \"john\" with defaults'",
      "AGENT: ''",
      "Run command: `sudo passwd john`",
      "AGENT: 'Enter new UNIX password:'",
      "AGENT: 'Retype new UNIX password:'",
      "AGENT: 'passwd: password updated successfully'",
      "AGENT: 'Sets password for john'",
      "AGENT: ''",
      "AGENT: 'âš ï¸ But this user has no home directory and can\\'t login! Let\\'s do it properly...'",
      "AGENT: ''",
      "AGENT: '--- Approach 2: Create User Properly ---'",
      "Run command: `sudo useradd -m -s /bin/bash alice`",
      "AGENT: '  -m = Create home directory'",
      "AGENT: '  -s = Set shell to /bin/bash'",
      "AGENT: ''",
      "Run command: `sudo passwd alice`",
      "AGENT: 'Set password'",
      "AGENT: ''",
      "Run command: `ls -la /home/alice`",
      "AGENT: 'total 20'",
      "AGENT: 'drwxr-x--- 2 alice alice 4096 Oct  8 10:00 .'",
      "AGENT: 'drwxr-xr-x 5 root  root  4096 Oct  8 10:00 ..'",
      "AGENT: '-rw-r--r-- 1 alice alice  220 Oct  8 10:00 .bash_logout'",
      "AGENT: '-rw-r--r-- 1 alice alice 3526 Oct  8 10:00 .bashrc'",
      "AGENT: '-rw-r--r-- 1 alice alice  807 Oct  8 10:00 .profile'",
      "AGENT: 'âœ“ Home directory created with default files!'",
      "AGENT: ''",
      "AGENT: '--- Approach 3: Create User with All Options ---'",
      "Run command: `sudo useradd -m -s /bin/bash -c \"Bob Smith\" -G developers,docker bob`",
      "AGENT: '  -m = Create home directory'",
      "AGENT: '  -s = Login shell'",
      "AGENT: '  -c = Comment (full name)'",
      "AGENT: '  -G = Additional groups'",
      "AGENT: ''",
      "Run command: `sudo passwd bob`",
      "AGENT: ''",
      "Run command: `id bob`",
      "AGENT: 'uid=1001(bob) gid=1001(bob) groups=1001(bob),999(docker),1002(developers)'",
      "AGENT: 'Shows user ID, group ID, and all groups'",
      "AGENT: ''",
      "AGENT: '--- Approach 4: Interactive User Creation (Easier) ---'",
      "Run command: `sudo adduser charlie`",
      "AGENT: 'Adding user \\`charlie\\' ...'",
      "AGENT: 'Adding new group \\`charlie\\' (1003) ...'",
      "AGENT: 'Adding new user \\`charlie\\' (1003) with group \\`charlie\\' ...'",
      "AGENT: 'Creating home directory \\`/home/charlie\\' ...'",
      "AGENT: 'Copying files from \\`/etc/skel\\' ...'",
      "AGENT: 'New password:'",
      "AGENT: 'Retype new password:'",
      "AGENT: 'Enter the new value, or press ENTER for the default'",
      "AGENT: '    Full Name []: Charlie Brown'",
      "AGENT: '    Room Number []: 123'",
      "AGENT: '    Work Phone []: 555-1234'",
      "AGENT: '    Home Phone []:'",
      "AGENT: '    Other []:'",
      "AGENT: 'Is the information correct? [Y/n] Y'",
      "AGENT: ''",
      "AGENT: 'adduser is more user-friendly (Debian/Ubuntu)'",
      "AGENT: 'useradd is more scriptable (all Linux)'",
      "AGENT: ''",
      "AGENT: '--- Approach 5: View User Information ---'",
      "Run command: `cat /etc/passwd | grep alice`",
      "AGENT: 'alice:x:1000:1000::/home/alice:/bin/bash'",
      "AGENT: 'â””â”€â”€â”€â”˜ â”‚ â””â”€â”€â”˜ â””â”€â”€â”˜ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜'",
      "AGENT: ' user  â”‚ UID  GID comment  home      shell'",
      "AGENT: '      password (x = in /etc/shadow)'",
      "AGENT: ''",
      "Run command: `getent passwd alice`",
      "AGENT: 'alice:x:1000:1000::/home/alice:/bin/bash'",
      "AGENT: 'Better way to query user database'",
      "AGENT: ''",
      "Run command: `finger alice`",
      "AGENT: 'Login: alice                          Name: Alice'",
      "AGENT: 'Directory: /home/alice                Shell: /bin/bash'",
      "AGENT: 'Last login: Tue Oct  8 10:00 (UTC) on pts/0'",
      "AGENT: ''",
      "AGENT: '--- Approach 6: Modify Existing User ---'",
      "Run command: `sudo usermod -c \"Alice Johnson\" alice`",
      "AGENT: '  -c = Change comment/full name'",
      "AGENT: ''",
      "Run command: `sudo usermod -s /bin/zsh alice`",
      "AGENT: '  -s = Change shell'",
      "AGENT: ''",
      "Run command: `sudo usermod -aG sudo alice`",
      "AGENT: '  -aG = Append to group (add to sudo group)'",
      "AGENT: '  âš ï¸ Without -a, replaces all groups!'",
      "AGENT: ''",
      "Run command: `sudo usermod -L alice`",
      "AGENT: '  -L = Lock account (disable login)'",
      "AGENT: ''",
      "Run command: `sudo usermod -U alice`",
      "AGENT: '  -U = Unlock account'",
      "AGENT: ''",
      "Run command: `sudo usermod -d /new/home -m alice`",
      "AGENT: '  -d = New home directory'",
      "AGENT: '  -m = Move existing files'",
      "AGENT: ''",
      "AGENT: '--- Approach 7: Group Management ---'",
      "Run command: `sudo groupadd developers`",
      "AGENT: 'Creates new group \"developers\"'",
      "AGENT: ''",
      "Run command: `sudo groupadd -g 2000 designers`",
      "AGENT: '  -g = Specify group ID (GID)'",
      "AGENT: ''",
      "Run command: `cat /etc/group | grep developers`",
      "AGENT: 'developers:x:1002:'",
      "AGENT: 'â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”˜ â”‚'",
      "AGENT: ' group    pwd GID  members'",
      "AGENT: ''",
      "Run command: `sudo usermod -aG developers alice`",
      "Run command: `sudo usermod -aG developers bob`",
      "AGENT: 'Add users to group'",
      "AGENT: ''",
      "Run command: `getent group developers`",
      "AGENT: 'developers:x:1002:alice,bob'",
      "AGENT: ''",
      "Run command: `groups alice`",
      "AGENT: 'alice : alice sudo developers'",
      "AGENT: 'Shows all groups alice is in'",
      "AGENT: ''",
      "AGENT: '--- Approach 8: Sudo Access Configuration ---'",
      "Run command: `sudo usermod -aG sudo alice`",
      "AGENT: 'Adds alice to sudo group (Debian/Ubuntu)'",
      "AGENT: ''",
      "Run command: `sudo usermod -aG wheel alice`",
      "AGENT: 'Adds alice to wheel group (RHEL/CentOS/Arch)'",
      "AGENT: ''",
      "AGENT: 'Custom sudo rules:'",
      "Run command: `sudo visudo`",
      "AGENT: 'Opens sudoers file safely'",
      "AGENT: ''",
      "AGENT: 'Add lines:'",
      "AGENT: '# User privilege specification'",
      "AGENT: 'alice ALL=(ALL:ALL) ALL'",
      "AGENT: ''",
      "AGENT: '# Allow developers group to run apt'",
      "AGENT: '%developers ALL=(ALL) NOPASSWD: /usr/bin/apt'",
      "AGENT: ''",
      "AGENT: '# Allow bob to restart nginx'",
      "AGENT: 'bob ALL=(ALL) NOPASSWD: /usr/bin/systemctl restart nginx'",
      "AGENT: ''",
      "AGENT: 'Sudo rules format:'",
      "AGENT: '  user/group  hosts=(run_as) commands'",
      "AGENT: '  NOPASSWD: = No password required'",
      "AGENT: '  % = Group prefix'",
      "AGENT: ''",
      "Run command: `sudo -l -U alice`",
      "AGENT: 'Shows sudo privileges for alice'",
      "AGENT: ''",
      "AGENT: '--- Approach 9: Password Management ---'",
      "Run command: `sudo passwd alice`",
      "AGENT: 'Change alice\\'s password (admin)'",
      "AGENT: ''",
      "Run command: `passwd`",
      "AGENT: 'Change your own password'",
      "AGENT: ''",
      "Run command: `sudo passwd -l alice`",
      "AGENT: '  -l = Lock password (disable password login)'",
      "AGENT: ''",
      "Run command: `sudo passwd -u alice`",
      "AGENT: '  -u = Unlock password'",
      "AGENT: ''",
      "Run command: `sudo passwd -e alice`",
      "AGENT: '  -e = Expire password (force change on next login)'",
      "AGENT: ''",
      "Run command: `sudo chage -l alice`",
      "AGENT: 'Last password change                    : Oct 08, 2025'",
      "AGENT: 'Password expires                        : never'",
      "AGENT: 'Password inactive                       : never'",
      "AGENT: 'Account expires                         : never'",
      "AGENT: 'Shows password aging info'",
      "AGENT: ''",
      "Run command: `sudo chage -M 90 alice`",
      "AGENT: '  -M = Maximum password age (90 days)'",
      "AGENT: ''",
      "Run command: `sudo chage -E 2025-12-31 alice`",
      "AGENT: '  -E = Account expiration date'",
      "AGENT: ''",
      "AGENT: '--- Approach 10: Delete Users ---'",
      "Run command: `sudo userdel john`",
      "AGENT: 'Deletes user (keeps home directory)'",
      "AGENT: ''",
      "Run command: `sudo userdel -r alice`",
      "AGENT: '  -r = Remove home directory and mail spool'",
      "AGENT: 'âš ï¸ Permanently deletes user\\'s files!'",
      "AGENT: ''",
      "Run command: `sudo userdel -f alice`",
      "AGENT: '  -f = Force (even if user is logged in)'",
      "AGENT: ''",
      "Run command: `sudo groupdel developers`",
      "AGENT: 'Deletes group'",
      "AGENT: 'âš ï¸ Can\\'t delete if it\\'s a primary group for any user'",
      "AGENT: ''",
      "AGENT: '--- Bonus: Bulk User Creation Script ---'",
      "Create tool: `cat > create-users.sh << 'EOF'`",
      "#!/bin/bash\nset -euo pipefail\n\nUSERS_FILE=\"${1:-users.txt}\"\n\nif [ ! -f \"$USERS_FILE\" ]; then\n    echo \"Usage: $0 <users_file>\"\n    echo \"\"\n    echo \"File format (CSV):\"\n    echo \"username,fullname,groups\"\n    echo \"alice,Alice Johnson,developers,sudo\"\n    echo \"bob,Bob Smith,developers\"\n    exit 1\nfi\n\nwhile IFS=, read -r username fullname groups; do\n    # Skip header and empty lines\n    if [[ \"$username\" == \"username\" ]] || [[ -z \"$username\" ]]; then\n        continue\n    fi\n    \n    echo \"Creating user: $username\"\n    \n    # Create user\n    if id \"$username\" &>/dev/null; then\n        echo \"  User $username already exists, skipping\"\n        continue\n    fi\n    \n    sudo useradd -m -s /bin/bash -c \"$fullname\" \"$username\"\n    \n    # Set temporary password\n    echo \"$username:ChangeMe123\" | sudo chpasswd\n    \n    # Force password change on first login\n    sudo passwd -e \"$username\"\n    \n    # Add to groups\n    if [ -n \"$groups\" ]; then\n        IFS=',' read -ra GROUP_ARRAY <<< \"$groups\"\n        for group in \"${GROUP_ARRAY[@]}\"; do\n            group=$(echo \"$group\" | xargs)  # Trim whitespace\n            if getent group \"$group\" > /dev/null 2>&1; then\n                sudo usermod -aG \"$group\" \"$username\"\n                echo \"  Added to group: $group\"\n            else\n                echo \"  Warning: Group $group doesn\\'t exist\"\n            fi\n        done\n    fi\n    \n    echo \"  âœ“ User $username created (password: ChangeMe123)\"\ndone < \"$USERS_FILE\"\n\necho \"\"\necho \"âœ“ User creation complete!\"\necho \"All users have temporary password: ChangeMe123\"\necho \"They will be forced to change it on first login.\"\nEOF",
      "Run command: `chmod +x create-users.sh`",
      "AGENT: ''",
      "Create tool: `cat > users.txt << 'EOF'`",
      "username,fullname,groups\nalice,Alice Johnson,developers,sudo\nbob,Bob Smith,developers\ncharlie,Charlie Brown,designers\nEOF",
      "AGENT: ''",
      "Run command: `sudo ./create-users.sh users.txt`",
      "AGENT: 'Creating user: alice'",
      "AGENT: '  Added to group: developers'",
      "AGENT: '  Added to group: sudo'",
      "AGENT: '  âœ“ User alice created (password: ChangeMe123)'",
      "AGENT: 'Creating user: bob'",
      "AGENT: '  Added to group: developers'",
      "AGENT: '  âœ“ User bob created (password: ChangeMe123)'",
      "AGENT: 'Creating user: charlie'",
      "AGENT: '  Added to group: designers'",
      "AGENT: '  âœ“ User charlie created (password: ChangeMe123)'",
      "AGENT: ''",
      "AGENT: 'âœ“ User creation complete!'",
      "AGENT: ''",
      "AGENT: '--- Bonus: User Audit Script ---'",
      "Create tool: `cat > audit-users.sh << 'EOF'`",
      "#!/bin/bash\n\necho \"=== USER AUDIT REPORT ===\"\necho \"Generated: $(date)\"\necho \"\"\n\necho \"--- Users with sudo access ---\"\ngetent group sudo | cut -d: -f4 | tr ',' '\\n'\ngetent group wheel 2>/dev/null | cut -d: -f4 | tr ',' '\\n'\necho \"\"\n\necho \"--- Users with /bin/bash shell ---\"\nawk -F: '$7 == \"/bin/bash\" {print $1}' /etc/passwd\necho \"\"\n\necho \"--- Recently created users (last 30 days) ---\"\nfind /home -maxdepth 1 -type d -mtime -30 -exec basename {} \\;\necho \"\"\n\necho \"--- Locked accounts ---\"\nawk -F: '($2 ~ /^!/) {print $1}' /etc/shadow 2>/dev/null | grep -v \"^root\"\necho \"\"\n\necho \"--- Users without passwords ---\"\nawk -F: '($2 == \"\" || $2 == \"!\") {print $1}' /etc/shadow 2>/dev/null\necho \"\"\n\necho \"--- All groups and members ---\"\ngetent group | awk -F: '$4 != \"\" {printf \"%-20s %s\\n\", $1, $4}'\nEOF",
      "Run command: `chmod +x audit-users.sh`",
      "Run command: `sudo ./audit-users.sh`",
      "AGENT: ''",
      "AGENT: 'âœ“ SOLUTION SUMMARY:'",
      "AGENT: '  âœ“ Created users with useradd -m -s /bin/bash.'",
      "AGENT: '  âœ“ Used adduser for interactive user creation.'",
      "AGENT: '  âœ“ Set passwords with passwd command.'",
      "AGENT: '  âœ“ Modified users with usermod (groups, shell, home).'",
      "AGENT: '  âœ“ Created and managed groups with groupadd.'",
      "AGENT: '  âœ“ Added users to groups with usermod -aG.'",
      "AGENT: '  âœ“ Configured sudo access with visudo.'",
      "AGENT: '  âœ“ Managed password aging with chage.'",
      "AGENT: '  âœ“ Deleted users with userdel -r.'",
      "AGENT: '  âœ“ Created bulk user creation script.'",
      "AGENT: '  âœ“ Built user audit report tool.'",
      "AGENT: '  âœ“ You now master Linux user and group management! ðŸ‘¥'"
    ],
    "commands": ["useradd", "usermod", "userdel", "groupadd", "groupdel", "passwd", "chage", "visudo", "id", "groups"],
    "packages": {
      "debian_ubuntu": ["passwd"],
      "arch": ["shadow"]
    },
    "related_commands": ["adduser", "deluser", "sudo", "getent"],
    "complexity": "intermediate",
    "tags": ["user-management", "useradd", "usermod", "groups", "sudo", "passwd", "permissions", "access-control", "chage"]
  }
]

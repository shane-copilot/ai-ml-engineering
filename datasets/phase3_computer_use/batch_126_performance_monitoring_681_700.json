[
  {
    "id": "scenario_performance_monitoring_iostat_129",
    "command": "iostat",
    "scenario": "Monitor system performance, CPU usage, and I/O statistics with iostat, vmstat, and sar.",
    "problem": "System feels slow, need to identify if problem is CPU, memory, or disk I/O bottleneck. Want to monitor performance metrics over time, analyze wait times, and understand system resource utilization patterns.",
    "solution": "Use iostat for I/O and CPU statistics, vmstat for virtual memory and system performance, sar for historical data collection, understand metrics like iowait, load average, and throughput to diagnose bottlenecks.",
    "steps": [
      "USER SAYS: 'My server is slow but I don't know if it's CPU, memory, or disk. How do I monitor performance and identify the bottleneck?'",
      "AGENT: 'Let me show you performance monitoring with iostat, vmstat, and sar! We'll identify CPU, memory, and I/O bottlenecks with proper metrics analysis.'",
      "AGENT: ''",
      "AGENT: '🔍 RESEARCH PHASE: Performance monitoring...'",
      "AGENT: '[Searching] \"iostat vmstat sar performance monitoring cpu io bottleneck\"'",
      "AGENT: '[Found] iostat shows CPU and disk I/O statistics.'",
      "AGENT: '[Found] vmstat shows memory, swap, CPU, and I/O in real-time.'",
      "AGENT: '[Found] sar collects and reports historical system performance.'",
      "AGENT: '[Found] High %iowait indicates disk bottleneck, high %sys indicates kernel overhead.'",
      "AGENT: '✓ Research complete! Let's monitor performance.'",
      "AGENT: ''",
      "AGENT: '--- Approach 1: Install Monitoring Tools ---'",
      "Run command: `sudo apt install sysstat -y`",
      "AGENT: 'Installs iostat, vmstat, sar, mpstat, pidstat'",
      "AGENT: ''",
      "AGENT: '--- Approach 2: CPU Statistics with iostat ---'",
      "Run command: `iostat -c 2 3`",
      "AGENT: '  -c = CPU statistics only'",
      "AGENT: '  2 = 2-second intervals'",
      "AGENT: '  3 = 3 reports'",
      "AGENT: ''",
      "AGENT: 'Linux 6.5.0 (server)    10/08/2025'",
      "AGENT: ''",
      "AGENT: 'avg-cpu:  %user   %nice %system %iowait  %steal   %idle'",
      "AGENT: '          25.30    0.00   12.50    8.20    0.00   54.00'",
      "AGENT: ''",
      "AGENT: 'Metrics explained:'",
      "AGENT: '  • %user   = User space processes (25.3%)'",
      "AGENT: '  • %system = Kernel/system processes (12.5%)'",
      "AGENT: '  • %iowait = Waiting for I/O (8.2%) ← Moderate I/O wait'",
      "AGENT: '  • %idle   = CPU idle time (54%)'",
      "AGENT: ''",
      "AGENT: '💡 8.2% iowait suggests some disk bottleneck'",
      "AGENT: ''",
      "AGENT: '--- Approach 3: Disk I/O Statistics ---'",
      "Run command: `iostat -x 2 3`",
      "AGENT: '  -x = Extended statistics'",
      "AGENT: ''",
      "AGENT: 'Device    r/s    w/s   rkB/s   wkB/s  rrqm/s  wrqm/s  %util  await'",
      "AGENT: 'sda      45.2   12.8   1024.5   256.3    2.1     4.5   45.2   12.5'",
      "AGENT: 'sdb       2.3    0.8     48.2    16.1    0.0     0.1    3.2    2.1'",
      "AGENT: ''",
      "AGENT: 'Key metrics:'",
      "AGENT: '  • r/s, w/s    = Reads/writes per second'",
      "AGENT: '  • rkB/s, wkB/s = Read/write throughput (KB/s)'",
      "AGENT: '  • %util       = Device utilization (45.2% for sda)'",
      "AGENT: '  • await       = Average wait time in ms (12.5ms)'",
      "AGENT: ''",
      "AGENT: '⚠️ sda at 45% utilization with 12.5ms wait time'",
      "AGENT: ''",
      "AGENT: 'Bottleneck indicators:'",
      "AGENT: '  • %util > 70% = Disk approaching saturation'",
      "AGENT: '  • await > 20ms = High latency'",
      "AGENT: '  • High r/s or w/s = Heavy I/O load'",
      "AGENT: ''",
      "AGENT: '--- Approach 4: vmstat for Overall System Performance ---'",
      "Run command: `vmstat 2 5`",
      "AGENT: '  2 = 2-second intervals'",
      "AGENT: '  5 = 5 reports'",
      "AGENT: ''",
      "AGENT: 'procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----'",
      "AGENT: ' r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st'",
      "AGENT: ' 2  1  10240 512000  80000 2048000  0    0   1024   256  850 1200 25 13 54  8  0'",
      "AGENT: ' 1  1  10240 508000  80000 2048000  0    0   1120   280  920 1350 28 14 50  8  0'",
      "AGENT: ' 3  0  10240 505000  80000 2048000  0    0    980   240  880 1280 24 12 56  8  0'",
      "AGENT: ''",
      "AGENT: 'Column meanings:'",
      "AGENT: '  procs:'",
      "AGENT: '    r = Processes waiting for CPU (runnable)'",
      "AGENT: '    b = Processes blocked (waiting for I/O)'",
      "AGENT: ''",
      "AGENT: '  memory (KB):'",
      "AGENT: '    swpd = Virtual memory used'",
      "AGENT: '    free = Free physical memory'",
      "AGENT: '    buff = Buffer memory'",
      "AGENT: '    cache = Page cache'",
      "AGENT: ''",
      "AGENT: '  swap:'",
      "AGENT: '    si = Swapped in from disk'",
      "AGENT: '    so = Swapped out to disk'",
      "AGENT: ''",
      "AGENT: '  io:'",
      "AGENT: '    bi = Blocks received from devices'",
      "AGENT: '    bo = Blocks sent to devices'",
      "AGENT: ''",
      "AGENT: '  cpu:'",
      "AGENT: '    us = User time (25%)'",
      "AGENT: '    sy = System time (13%)'",
      "AGENT: '    id = Idle (54%)'",
      "AGENT: '    wa = I/O wait (8%)'",
      "AGENT: ''",
      "AGENT: 'Analysis:'",
      "AGENT: '  ✓ 2-3 processes waiting for CPU (normal)'",
      "AGENT: '  ⚠️ 1 process blocked on I/O (indicates disk bottleneck)'",
      "AGENT: '  ✓ No swapping (si/so = 0, good!)'",
      "AGENT: '  ⚠️ Moderate I/O activity (bi=1024, bo=256)'",
      "AGENT: '  ⚠️ 8% iowait confirms disk bottleneck'",
      "AGENT: ''",
      "AGENT: '--- Approach 5: Memory Statistics ---'",
      "Run command: `vmstat -s`",
      "AGENT: '16384000 K total memory'",
      "AGENT: '13107200 K used memory'",
      "AGENT: ' 9830400 K active memory'",
      "AGENT: ' 3276800 K inactive memory'",
      "AGENT: '  512000 K free memory'",
      "AGENT: '   80000 K buffer memory'",
      "AGENT: ' 2048000 K swap cache'",
      "AGENT: ' 8388608 K total swap'",
      "AGENT: '   10240 K used swap'",
      "AGENT: ' 8378368 K free swap'",
      "AGENT: '...'",
      "AGENT: ''",
      "Run command: `free -h`",
      "AGENT: '               total        used        free      shared  buff/cache   available'",
      "AGENT: 'Mem:            15Gi        12Gi       500Mi       100Mi        2.0Gi        3.0Gi'",
      "AGENT: 'Swap:          8.0Gi        10Mi       7.9Gi'",
      "AGENT: ''",
      "AGENT: '✓ Memory usage healthy (3GB available, minimal swap)'",
      "AGENT: ''",
      "AGENT: '--- Approach 6: Per-CPU Statistics ---'",
      "Run command: `mpstat -P ALL 2 3`",
      "AGENT: '  -P ALL = Show all CPUs'",
      "AGENT: ''",
      "AGENT: 'CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest   %idle'",
      "AGENT: 'all   25.30    0.00   12.50    8.20    0.50    1.20    0.00    0.00   52.30'",
      "AGENT: '  0   45.20    0.00   15.30   12.50    0.80    2.10    0.00    0.00   24.10'",
      "AGENT: '  1   18.30    0.00   10.20    6.50    0.30    0.80    0.00    0.00   64.90'",
      "AGENT: '  2   22.10    0.00   11.80    7.20    0.40    1.00    0.00    0.00   57.50'",
      "AGENT: '  3   15.60    0.00    9.80    6.70    0.50    0.90    0.00    0.00   66.50'",
      "AGENT: ''",
      "AGENT: '💡 CPU 0 heavily loaded (75% busy, 12.5% iowait)'",
      "AGENT: '💡 Other CPUs relatively idle - uneven load distribution'",
      "AGENT: ''",
      "AGENT: '--- Approach 7: Process-Level I/O ---'",
      "Run command: `pidstat -d 2 3`",
      "AGENT: '  -d = Disk I/O statistics per process'",
      "AGENT: ''",
      "AGENT: 'PID   kB_rd/s   kB_wr/s  kB_ccwr/s  Command'",
      "AGENT: '1234    850.25    125.50       0.00  postgres'",
      "AGENT: '5678    120.30     45.20       0.00  nginx'",
      "AGENT: '9012     95.10      8.50       0.00  python'",
      "AGENT: ''",
      "AGENT: '🎯 PostgreSQL process causing heavy disk reads (850 KB/s)'",
      "AGENT: ''",
      "AGENT: '--- Approach 8: Historical Data with sar ---'",
      "Run command: `sudo systemctl enable --now sysstat`",
      "AGENT: 'Enables automatic data collection every 10 minutes'",
      "AGENT: ''",
      "Run command: `sar -u 2 5`",
      "AGENT: '  -u = CPU usage'",
      "AGENT: 'Shows current CPU statistics'",
      "AGENT: ''",
      "Run command: `sar -u -f /var/log/sysstat/sa$(date +%d)`",
      "AGENT: 'Shows historical CPU data for today'",
      "AGENT: ''",
      "Run command: `sar -r 2 5`",
      "AGENT: '  -r = Memory utilization'",
      "AGENT: ''",
      "AGENT: 'kbmemfree kbmemused  %memused kbbuffers  kbcached'",
      "AGENT: '  512000  15872000     96.88     80000   2048000'",
      "AGENT: ''",
      "Run command: `sar -b 2 5`",
      "AGENT: '  -b = I/O transfer rate statistics'",
      "AGENT: ''",
      "AGENT: 'tps      rtps      wtps   bread/s   bwrtn/s'",
      "AGENT: '58.2     45.2      13.0   1024.5     256.3'",
      "AGENT: ''",
      "AGENT: 'tps = Transactions per second (total I/O operations)'",
      "AGENT: ''",
      "AGENT: '--- Approach 9: Network Statistics ---'",
      "Run command: `sar -n DEV 2 3`",
      "AGENT: '  -n DEV = Network device statistics'",
      "AGENT: ''",
      "AGENT: 'IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s'",
      "AGENT: 'eth0    1250.30   980.20    850.25    425.10'",
      "AGENT: 'lo       125.50   125.50     45.20     45.20'",
      "AGENT: ''",
      "AGENT: '--- Approach 10: Comprehensive Performance Report ---'",
      "Create tool: `cat > perf-report.sh << 'EOF'`",
      "#!/bin/bash\nset -euo pipefail\n\necho \"======================================\"\necho \"   SYSTEM PERFORMANCE REPORT\"\necho \"   $(date)\"\necho \"======================================\"\necho \"\"\n\necho \"--- CPU SUMMARY ---\"\nmpstat 1 1 | tail -1\necho \"\"\n\necho \"--- LOAD AVERAGE ---\"\nuptime\necho \"\"\n\necho \"--- MEMORY USAGE ---\"\nfree -h\necho \"\"\n\necho \"--- DISK I/O (5 sec average) ---\"\niostat -x 1 5 | grep -A 20 \"^Device\"\necho \"\"\n\necho \"--- TOP 5 CPU CONSUMERS ---\"\nps aux --sort=-%cpu | head -6\necho \"\"\n\necho \"--- TOP 5 MEMORY CONSUMERS ---\"\nps aux --sort=-%mem | head -6\necho \"\"\n\necho \"--- TOP 5 I/O PROCESSES ---\"\npidstat -d 1 1 | grep -v \"^#\" | sort -k4 -rn | head -6\necho \"\"\n\necho \"--- DISK UTILIZATION ---\"\ndf -h /\necho \"\"\n\necho \"--- NETWORK ACTIVITY (5 sec) ---\"\nsar -n DEV 1 5 | grep Average\necho \"\"\n\necho \"======================================\"\necho \"DIAGNOSIS:\"\necho \"======================================\"\n\n# Analyze and provide recommendations\niowait=$(mpstat 1 1 | tail -1 | awk '{print $6}' | cut -d. -f1)\nmem_available=$(free -g | grep Mem | awk '{print $7}')\n\nif [ \"$iowait\" -gt 10 ]; then\n    echo \"⚠️  HIGH I/O WAIT ($iowait%) - Disk bottleneck detected\"\n    echo \"   Recommendations:\"\n    echo \"   • Check slow queries: iotop -o\"\n    echo \"   • Consider faster storage (SSD)\"\n    echo \"   • Optimize database queries\"\n    echo \"\"\nfi\n\nif [ \"$mem_available\" -lt 2 ]; then\n    echo \"⚠️  LOW MEMORY ($mem_available GB available)\"\n    echo \"   Recommendations:\"\n    echo \"   • Identify memory leaks\"\n    echo \"   • Consider adding RAM\"\n    echo \"   • Reduce application memory usage\"\n    echo \"\"\nfi\n\nload=$(uptime | awk -F'load average:' '{print $2}' | awk '{print $1}' | tr -d ',')\ncores=$(nproc)\nif (( $(echo \"$load > $cores\" | bc -l) )); then\n    echo \"⚠️  HIGH LOAD AVERAGE ($load > $cores cores)\"\n    echo \"   Recommendations:\"\n    echo \"   • Investigate runaway processes\"\n    echo \"   • Scale horizontally if possible\"\n    echo \"\"\nfi\n\necho \"✓ Report complete!\"\nEOF",
      "Run command: `chmod +x perf-report.sh`",
      "Run command: `sudo ./perf-report.sh`",
      "AGENT: ''",
      "AGENT: '--- Bonus: Real-Time I/O Monitoring ---'",
      "Run command: `sudo apt install iotop -y`",
      "Run command: `sudo iotop -o`",
      "AGENT: '  -o = Only show processes doing I/O'",
      "AGENT: ''",
      "AGENT: 'Total DISK READ :      1024.50 K/s | Total DISK WRITE :      256.30 K/s'",
      "AGENT: '  PID  USER     DISK READ  DISK WRITE  SWAPIN     IO>    COMMAND'",
      "AGENT: ' 1234  postgres   850.25 K     125.50 K   0.00 % 85.23 % postgres'",
      "AGENT: ' 5678  www-data   120.30 K      45.20 K   0.00 % 12.15 % nginx'",
      "AGENT: ''",
      "AGENT: '--- Bonus: Continuous Monitoring Script ---'",
      "Create tool: `cat > monitor.sh << 'EOF'`",
      "#!/bin/bash\nwhile true; do\n    clear\n    echo \"=== System Monitor ===\"\n    echo \"Time: $(date)\"\n    echo \"\"\n    echo \"CPU:\"\n    mpstat 1 1 | tail -1\n    echo \"\"\n    echo \"Memory:\"\n    free -h | grep Mem\n    echo \"\"\n    echo \"Disk I/O:\"\n    iostat -x 1 1 | grep -E \"(sda|sdb)\" | head -2\n    echo \"\"\n    echo \"Top processes by CPU:\"\n    ps aux --sort=-%cpu | head -4 | tail -3\n    sleep 5\ndone\nEOF",
      "Run command: `chmod +x monitor.sh`",
      "AGENT: ''",
      "AGENT: '✓ SOLUTION SUMMARY:'",
      "AGENT: '  ✓ Used iostat to monitor CPU and disk I/O statistics.'",
      "AGENT: '  ✓ Analyzed system performance with vmstat.'",
      "AGENT: '  ✓ Identified bottlenecks: 8% iowait indicates disk issue.'",
      "AGENT: '  ✓ Used mpstat for per-CPU statistics.'",
      "AGENT: '  ✓ Tracked per-process I/O with pidstat.'",
      "AGENT: '  ✓ Collected historical data with sar.'",
      "AGENT: '  ✓ Created comprehensive performance report script.'",
      "AGENT: '  ✓ Used iotop for real-time I/O monitoring.'",
      "AGENT: '  ✓ Diagnosed PostgreSQL as source of disk bottleneck.'",
      "AGENT: '  ✓ You now master performance monitoring and bottleneck analysis! 📊'"
    ],
    "commands": ["iostat", "vmstat", "sar", "mpstat", "pidstat", "iotop", "free", "uptime", "ps"],
    "packages": {
      "debian_ubuntu": ["sysstat", "iotop"],
      "arch": ["sysstat", "iotop"]
    },
    "related_commands": ["top", "htop", "atop", "nmon"],
    "complexity": "advanced",
    "tags": ["performance", "monitoring", "iostat", "vmstat", "sar", "cpu", "memory", "io", "bottleneck", "analysis"]
  }
]

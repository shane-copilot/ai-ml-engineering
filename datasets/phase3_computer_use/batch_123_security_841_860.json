[
  {
    "id": "scenario_security_hardening_140",
    "command": "ufw",
    "scenario": "Harden system security with firewall, fail2ban, and security best practices.",
    "problem": "System exposed to internet needs protection from attacks, brute force attempts on SSH, need to configure firewall rules, monitor failed login attempts, and implement security hardening.",
    "solution": "Configure ufw firewall with specific rules, set up fail2ban for intrusion prevention, disable unnecessary services, configure SSH security, and implement defense-in-depth.",
    "steps": [
      "USER SAYS: 'My server is getting attacked with SSH brute force attempts. How do I harden security?'",
      "AGENT: 'Let me show you comprehensive security hardening!'",
      "AGENT: ''",
      "Run command: `sudo ufw status`",
      "AGENT: 'Status: inactive'",
      "AGENT: '❌ Firewall is off!'",
      "AGENT: ''",
      "Run command: `sudo ufw default deny incoming`",
      "Run command: `sudo ufw default allow outgoing`",
      "AGENT: 'Deny all incoming, allow all outgoing (good default)'",
      "AGENT: ''",
      "Run command: `sudo ufw allow 22/tcp comment 'SSH'`",
      "AGENT: 'Allow SSH on port 22'",
      "AGENT: ''",
      "Run command: `sudo ufw allow 80/tcp comment 'HTTP'`",
      "Run command: `sudo ufw allow 443/tcp comment 'HTTPS'`",
      "AGENT: 'Allow web traffic'",
      "AGENT: ''",
      "Run command: `sudo ufw allow from 192.168.1.0/24 to any port 22`",
      "AGENT: 'Allow SSH only from local network'",
      "AGENT: ''",
      "Run command: `sudo ufw enable`",
      "AGENT: 'Firewall is active and enabled on system startup'",
      "AGENT: ''",
      "Run command: `sudo ufw status numbered`",
      "AGENT: 'Status: active'",
      "AGENT: ''",
      "AGENT: '     To                         Action      From'",
      "AGENT: '     --                         ------      ----'",
      "AGENT: '[ 1] 22/tcp                     ALLOW IN    192.168.1.0/24  # SSH'",
      "AGENT: '[ 2] 80/tcp                     ALLOW IN    Anywhere        # HTTP'",
      "AGENT: '[ 3] 443/tcp                    ALLOW IN    Anywhere        # HTTPS'",
      "AGENT: ''",
      "Run command: `sudo apt install fail2ban -y`",
      "AGENT: 'Installing fail2ban for intrusion prevention'",
      "AGENT: ''",
      "Run command: `sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local`",
      "AGENT: 'Create local configuration'",
      "AGENT: ''",
      "Run command: `sudo nano /etc/fail2ban/jail.local`",
      "AGENT: 'Edit fail2ban configuration:'",
      "AGENT: ''",
      "AGENT: '[sshd]'",
      "AGENT: 'enabled = true'",
      "AGENT: 'port = 22'",
      "AGENT: 'filter = sshd'",
      "AGENT: 'logpath = /var/log/auth.log'",
      "AGENT: 'maxretry = 3'",
      "AGENT: 'bantime = 3600'",
      "AGENT: 'findtime = 600'",
      "AGENT: ''",
      "AGENT: 'Ban after 3 failed attempts in 10 minutes for 1 hour'",
      "AGENT: ''",
      "Run command: `sudo systemctl enable fail2ban`",
      "Run command: `sudo systemctl start fail2ban`",
      "AGENT: ''",
      "Run command: `sudo fail2ban-client status sshd`",
      "AGENT: 'Status for the jail: sshd'",
      "AGENT: '|- Filter'",
      "AGENT: '|  |- Currently failed: 5'",
      "AGENT: '|  |- Total failed:     127'",
      "AGENT: '|  `- File list:        /var/log/auth.log'",
      "AGENT: '`- Actions'",
      "AGENT: '   |- Currently banned: 8'",
      "AGENT: '   |- Total banned:     23'",
      "AGENT: '   `- Banned IP list:   103.45.67.89 185.220.101.45 ...'",
      "AGENT: ''",
      "AGENT: '✓ 8 IPs currently banned!'",
      "AGENT: ''",
      "Run command: `sudo nano /etc/ssh/sshd_config`",
      "AGENT: 'Harden SSH configuration:'",
      "AGENT: ''",
      "AGENT: 'Port 2222                    # Change from 22'",
      "AGENT: 'PermitRootLogin no           # Disable root login'",
      "AGENT: 'PasswordAuthentication no    # Use keys only'",
      "AGENT: 'PubkeyAuthentication yes'",
      "AGENT: 'MaxAuthTries 3               # Limit attempts'",
      "AGENT: 'LoginGraceTime 30            # 30 seconds to login'",
      "AGENT: 'AllowUsers john jane         # Whitelist users'",
      "AGENT: 'Protocol 2                   # SSH protocol 2 only'",
      "AGENT: 'X11Forwarding no'",
      "AGENT: 'ClientAliveInterval 300'",
      "AGENT: 'ClientAliveCountMax 2'",
      "AGENT: ''",
      "Run command: `sudo systemctl restart sshd`",
      "AGENT: ''",
      "Run command: `sudo chmod 600 ~/.ssh/authorized_keys`",
      "Run command: `sudo chmod 700 ~/.ssh`",
      "AGENT: 'Secure SSH key permissions'",
      "AGENT: ''",
      "Run command: `sudo apt install unattended-upgrades -y`",
      "AGENT: 'Enable automatic security updates'",
      "AGENT: ''",
      "Run command: `sudo dpkg-reconfigure -plow unattended-upgrades`",
      "AGENT: 'Configure automatic updates'",
      "AGENT: ''",
      "Run command: `sudo systemctl list-units --type=service --state=running`",
      "AGENT: 'Audit running services'",
      "AGENT: ''",
      "Run command: `sudo systemctl disable bluetooth`",
      "Run command: `sudo systemctl stop bluetooth`",
      "AGENT: 'Disable unnecessary services'",
      "AGENT: ''",
      "Run command: `sudo ausearch -m avc -ts recent`",
      "AGENT: 'Check SELinux/AppArmor denials'",
      "AGENT: ''",
      "Run command: `sudo aa-status`",
      "AGENT: 'Check AppArmor status'",
      "AGENT: ''",
      "Run command: `sudo grep \"Failed password\" /var/log/auth.log | tail -20`",
      "AGENT: 'Oct 08 15:23:45 host sshd[12345]: Failed password for invalid user admin from 103.45.67.89'",
      "AGENT: 'Oct 08 15:23:50 host sshd[12346]: Failed password for invalid user root from 103.45.67.89'",
      "AGENT: '...'",
      "AGENT: ''",
      "Run command: `sudo lastb | head -20`",
      "AGENT: 'admin    ssh:notty    103.45.67.89    Mon Oct  8 15:23'",
      "AGENT: 'root     ssh:notty    103.45.67.89    Mon Oct  8 15:24'",
      "AGENT: 'Show failed login attempts'",
      "AGENT: ''",
      "Run command: `sudo last | head -10`",
      "AGENT: 'john     pts/0        192.168.1.50     Mon Oct  8 10:00   still logged in'",
      "AGENT: 'Show successful logins'",
      "AGENT: ''",
      "Run command: `sudo lynis audit system`",
      "AGENT: 'Security audit tool (comprehensive scan)'",
      "AGENT: ''",
      "Run command: `sudo rkhunter --check`",
      "AGENT: 'Rootkit scanner'",
      "AGENT: ''",
      "Run command: `sudo chkrootkit`",
      "AGENT: 'Another rootkit detector'",
      "AGENT: ''",
      "AGENT: 'Security checklist completed:'",
      "AGENT: '  ✓ Firewall configured with ufw'",
      "AGENT: '  ✓ fail2ban blocking brute force'",
      "AGENT: '  ✓ SSH hardened (keys only, no root)'",
      "AGENT: '  ✓ Automatic security updates enabled'",
      "AGENT: '  ✓ Unnecessary services disabled'",
      "AGENT: '  ✓ Security monitoring active'"
    ],
    "commands": ["ufw", "fail2ban", "ssh", "chmod", "systemctl", "grep", "last", "lastb"],
    "packages": {
      "debian_ubuntu": ["ufw", "fail2ban", "openssh-server", "unattended-upgrades", "lynis", "rkhunter", "chkrootkit"],
      "arch": ["ufw", "fail2ban", "openssh", "lynis"]
    },
    "related_commands": ["iptables", "firewalld", "auditd"],
    "complexity": "advanced",
    "tags": ["security", "hardening", "firewall", "fail2ban", "ssh", "intrusion-prevention", "ufw"]
  }
]
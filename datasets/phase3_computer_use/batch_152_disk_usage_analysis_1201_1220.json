[
  {
    "id": "scenario_disk_usage_analysis_150",
    "command": "du",
    "scenario": "Analyze disk usage to find large files and directories consuming space.",
    "problem": "Disk is full or running low on space. Need to identify what's using disk space, find largest directories and files, clean up old logs and caches, and understand where storage is being consumed.",
    "solution": "Use du to analyze disk usage by directory, combine with sort to find largest items, use df to check filesystem usage, find command for specific files, and ncdu for interactive exploration.",
    "steps": [
      "USER SAYS: 'My disk is almost full! How do I find what's taking up all the space?'",
      "AGENT: 'Let me show you disk usage analysis! We'll use du, df, find, and ncdu to locate space hogs and free up disk space.'",
      "AGENT: ''",
      "AGENT: '🔍 RESEARCH PHASE: Disk usage analysis...'",
      "AGENT: '[Searching] \"linux disk usage du df find large files space\"'",
      "AGENT: '[Found] df shows filesystem usage, du shows directory sizes.'",
      "AGENT: '[Found] du -h for human-readable, -s for summary.'",
      "AGENT: '[Found] ncdu for interactive disk usage browser.'",
      "AGENT: '[Found] find for locating large/old files.'",
      "AGENT: '✓ Research complete! Let's find those space hogs.'",
      "AGENT: ''",
      "AGENT: '--- Approach 1: Check Overall Disk Usage ---'",
      "Run command: `df -h`",
      "AGENT: 'Filesystem      Size  Used Avail Use% Mounted on'",
      "AGENT: '/dev/sda1        50G   45G  2.5G  95% /'",
      "AGENT: '/dev/sda2       100G   20G   75G  21% /home'",
      "AGENT: 'tmpfs           7.8G  1.2G  6.6G  16% /tmp'",
      "AGENT: ''",
      "AGENT: '⚠️  Root partition is 95% full!'",
      "AGENT: ''",
      "Run command: `df -h /`",
      "AGENT: 'Check specific filesystem'",
      "AGENT: ''",
      "Run command: `df -i`",
      "AGENT: 'Filesystem      Inodes  IUsed   IFree IUse% Mounted on'",
      "AGENT: '/dev/sda1      3276800 245678 3031122    8% /'",
      "AGENT: 'Check inode usage (can run out even with free space)'",
      "AGENT: ''",
      "AGENT: '--- Approach 2: Find Largest Directories ---'",
      "Run command: `du -h --max-depth=1 / 2>/dev/null | sort -hr | head -20`",
      "AGENT: '  -h = Human readable'",
      "AGENT: '  --max-depth=1 = One level deep'",
      "AGENT: '  sort -hr = Sort human-readable, reverse'",
      "AGENT: ''",
      "AGENT: '40G\t/'",
      "AGENT: '25G\t/var'",
      "AGENT: '8.0G\t/usr'",
      "AGENT: '4.5G\t/home'",
      "AGENT: '2.1G\t/opt'",
      "AGENT: '500M\t/tmp'",
      "AGENT: '...'",
      "AGENT: ''",
      "AGENT: '/var is using 25GB! Let's investigate:'",
      "Run command: `du -h --max-depth=1 /var 2>/dev/null | sort -hr | head -10`",
      "AGENT: '25G\t/var'",
      "AGENT: '18G\t/var/log'",
      "AGENT: '5.2G\t/var/cache'",
      "AGENT: '1.5G\t/var/lib'",
      "AGENT: '...'",
      "AGENT: ''",
      "AGENT: '/var/log is the culprit! 18GB of logs!'",
      "AGENT: ''",
      "Run command: `du -h --max-depth=1 /var/log 2>/dev/null | sort -hr | head -10`",
      "AGENT: '18G\t/var/log'",
      "AGENT: '12G\t/var/log/journal'",
      "AGENT: '4.5G\t/var/log/syslog.1'",
      "AGENT: '1.2G\t/var/log/apache2'",
      "AGENT: '...'",
      "AGENT: ''",
      "AGENT: '--- Approach 3: Find Largest Files ---'",
      "Run command: `find /var/log -type f -size +100M -exec ls -lh {} \\; 2>/dev/null | awk '{print $5, $9}' | sort -hr`",
      "AGENT: '  -type f = Files only'",
      "AGENT: '  -size +100M = Larger than 100MB'",
      "AGENT: ''",
      "AGENT: '4.5G /var/log/syslog.1'",
      "AGENT: '2.1G /var/log/kern.log.1'",
      "AGENT: '850M /var/log/apache2/access.log'",
      "AGENT: '320M /var/log/mysql/error.log'",
      "AGENT: '...'",
      "AGENT: ''",
      "AGENT: 'Alternative with du:'",
      "Run command: `find /var/log -type f -exec du -h {} + 2>/dev/null | sort -hr | head -20`",
      "AGENT: ''",
      "AGENT: '--- Approach 4: Interactive Disk Usage (ncdu) ---'",
      "Run command: `sudo apt install ncdu -y`",
      "AGENT: ''",
      "Run command: `ncdu /`",
      "AGENT: '┌─ /var ─────────────────────────────────────────┐'",
      "AGENT: '│   25.0 GiB [##########] /log                   │'",
      "AGENT: '│    5.2 GiB [##        ] /cache                 │'",
      "AGENT: '│    1.5 GiB [          ] /lib                   │'",
      "AGENT: '│                                                │'",
      "AGENT: '│ Interactive navigation with arrow keys         │'",
      "AGENT: '│ Press d to delete, q to quit                   │'",
      "AGENT: '└────────────────────────────────────────────────┘'",
      "AGENT: ''",
      "AGENT: 'ncdu features:'",
      "AGENT: '  ↑↓ = Navigate'",
      "AGENT: '  Enter = Enter directory'",
      "AGENT: '  d = Delete (with confirmation)'",
      "AGENT: '  r = Refresh'",
      "AGENT: '  g = Show percentage/graph'",
      "AGENT: '  ? = Help'",
      "AGENT: ''",
      "AGENT: '--- Approach 5: Clean Up Logs ---'",
      "AGENT: ''",
      "AGENT: 'Check journal size:'",
      "Run command: `journalctl --disk-usage`",
      "AGENT: 'Archived and active journals take up 12.0G in the file system.'",
      "AGENT: ''",
      "AGENT: 'Clean old journal entries:'",
      "Run command: `sudo journalctl --vacuum-size=1G`",
      "AGENT: 'Vacuuming done, freed 11.0G'",
      "AGENT: 'Keeps only 1GB of journals'",
      "AGENT: ''",
      "Run command: `sudo journalctl --vacuum-time=7d`",
      "AGENT: 'Keep only last 7 days'",
      "AGENT: ''",
      "AGENT: 'Make journal size limit permanent:'",
      "Create tool: `sudo tee -a /etc/systemd/journald.conf << 'EOF'`",
      "[Journal]\nSystemMaxUse=1G\nMaxRetentionSec=7day\nEOF",
      "Run command: `sudo systemctl restart systemd-journald`",
      "AGENT: ''",
      "AGENT: 'Rotate and compress logs:'",
      "Run command: `sudo logrotate -f /etc/logrotate.conf`",
      "AGENT: 'Forces log rotation'",
      "AGENT: ''",
      "AGENT: 'Remove old compressed logs:'",
      "Run command: `sudo find /var/log -name '*.gz' -mtime +30 -delete`",
      "AGENT: '  -mtime +30 = Older than 30 days'",
      "AGENT: '  -delete = Remove files'",
      "AGENT: ''",
      "AGENT: '--- Approach 6: Clean Package Caches ---'",
      "AGENT: ''",
      "AGENT: 'APT cache (Debian/Ubuntu):'",
      "Run command: `du -sh /var/cache/apt/archives`",
      "AGENT: '2.3G\t/var/cache/apt/archives'",
      "AGENT: ''",
      "Run command: `sudo apt clean`",
      "AGENT: 'Removes all downloaded package files'",
      "AGENT: ''",
      "Run command: `du -sh /var/cache/apt/archives`",
      "AGENT: '12K\t/var/cache/apt/archives'",
      "AGENT: 'Freed 2.3GB!'",
      "AGENT: ''",
      "AGENT: 'Pacman cache (Arch):'",
      "Run command: `du -sh /var/cache/pacman/pkg`",
      "Run command: `sudo pacman -Sc`",
      "AGENT: 'Remove old packages'",
      "AGENT: ''",
      "AGENT: '--- Approach 7: Find Old Files ---'",
      "Run command: `find /tmp -type f -atime +30 -ls`",
      "AGENT: '  -atime +30 = Not accessed in 30+ days'",
      "AGENT: 'Lists old temporary files'",
      "AGENT: ''",
      "Run command: `find /home -type f -mtime +365 -size +100M`",
      "AGENT: 'Large files (>100MB) not modified in 365+ days'",
      "AGENT: ''",
      "Run command: `find / -type f -mtime -7 -size +1G 2>/dev/null`",
      "AGENT: 'Files created in last 7 days larger than 1GB'",
      "AGENT: ''",
      "AGENT: '--- Approach 8: Docker Cleanup ---'",
      "Run command: `docker system df`",
      "AGENT: 'TYPE            TOTAL   ACTIVE   SIZE      RECLAIMABLE'",
      "AGENT: 'Images          15      5        8.5GB     5.2GB (61%)'",
      "AGENT: 'Containers      20      3        200MB     180MB (90%)'",
      "AGENT: 'Local Volumes   10      4        2.3GB     1.1GB (48%)'",
      "AGENT: ''",
      "Run command: `docker system prune -a --volumes`",
      "AGENT: 'Remove all unused images, containers, volumes'",
      "AGENT: 'WARNING: This will remove:'",
      "AGENT: '  - all stopped containers'",
      "AGENT: '  - all networks not used by containers'",
      "AGENT: '  - all images without containers'",
      "AGENT: '  - all volumes not used by containers'",
      "AGENT: '  - build cache'",
      "AGENT: 'Total reclaimed space: 8.5GB'",
      "AGENT: ''",
      "AGENT: '--- Approach 9: Find Duplicate Files ---'",
      "Run command: `sudo apt install fdupes -y`",
      "AGENT: ''",
      "Run command: `fdupes -r /home/user/Downloads`",
      "AGENT: '  -r = Recursive'",
      "AGENT: '/home/user/Downloads/file1.pdf'",
      "AGENT: '/home/user/Downloads/backup/file1.pdf'",
      "AGENT: ''",
      "AGENT: '/home/user/Downloads/photo.jpg'",
      "AGENT: '/home/user/Downloads/photos/photo.jpg'",
      "AGENT: ''",
      "Run command: `fdupes -r -d /home/user/Downloads`",
      "AGENT: '  -d = Delete duplicates (prompts which to keep)'",
      "AGENT: ''",
      "AGENT: '--- Approach 10: Comprehensive Space Analysis ---'",
      "Create tool: `cat > disk-analysis.sh << 'EOF'`",
      "#!/bin/bash\nset -euo pipefail\n\necho \"=== Disk Space Analysis ===\"\necho \"\"\n\necho \"1. Filesystem Usage:\"\ndf -h | grep -v tmpfs | grep -v devtmpfs\necho \"\"\n\necho \"2. Largest Directories in /:\"\ndu -h --max-depth=1 / 2>/dev/null | sort -hr | head -10\necho \"\"\n\necho \"3. Largest Files (>1GB):\"\nfind / -type f -size +1G -exec ls -lh {} \\; 2>/dev/null | \\\n  awk '{print $5, $9}' | sort -hr | head -10\necho \"\"\n\necho \"4. Journal Size:\"\njournalctl --disk-usage\necho \"\"\n\necho \"5. Package Cache:\"\nif [ -d /var/cache/apt/archives ]; then\n  echo \"APT: $(du -sh /var/cache/apt/archives | cut -f1)\"\nfi\nif [ -d /var/cache/pacman/pkg ]; then\n  echo \"Pacman: $(du -sh /var/cache/pacman/pkg | cut -f1)\"\nfi\necho \"\"\n\necho \"6. Docker Usage:\"\nif command -v docker &> /dev/null; then\n  docker system df 2>/dev/null || echo \"Docker not running\"\nfi\necho \"\"\n\necho \"7. Old Temporary Files:\"\nfind /tmp -type f -atime +7 2>/dev/null | wc -l\necho \" files older than 7 days in /tmp\"\necho \"\"\n\necho \"=== Analysis Complete ===\"\nEOF",
      "Run command: `chmod +x disk-analysis.sh && sudo ./disk-analysis.sh`",
      "AGENT: ''",
      "AGENT: '--- Bonus: Space Cleanup Script ---'",
      "Create tool: `cat > cleanup-space.sh << 'EOF'`",
      "#!/bin/bash\nset -euo pipefail\n\nif [ \"$(id -u)\" -ne 0 ]; then\n  echo \"Must run as root\"\n  exit 1\nfi\n\necho \"Starting disk cleanup...\"\n\n# Initial space\nINITIAL=$(df / | tail -1 | awk '{print $3}')\n\n# Clean journal\necho \"Cleaning systemd journal...\"\njournalctl --vacuum-size=500M\n\n# Clean package caches\necho \"Cleaning package caches...\"\nif command -v apt &> /dev/null; then\n  apt clean\n  apt autoremove -y\nfi\n\nif command -v pacman &> /dev/null; then\n  pacman -Sc --noconfirm\nfi\n\n# Rotate logs\necho \"Rotating logs...\"\nlogrotate -f /etc/logrotate.conf\n\n# Remove old compressed logs\necho \"Removing old logs...\"\nfind /var/log -name '*.gz' -mtime +30 -delete\nfind /var/log -name '*.1' -mtime +7 -delete\n\n# Clean tmp\necho \"Cleaning temp files...\"\nfind /tmp -type f -atime +7 -delete 2>/dev/null || true\nfind /var/tmp -type f -atime +7 -delete 2>/dev/null || true\n\n# Docker cleanup\nif command -v docker &> /dev/null; then\n  echo \"Cleaning Docker...\"\n  docker system prune -f --volumes 2>/dev/null || true\nfi\n\n# Final space\nFINAL=$(df / | tail -1 | awk '{print $3}')\nFREED=$((INITIAL - FINAL))\n\necho \"\"\necho \"=== Cleanup Complete ===\"\necho \"Space freed: $(numfmt --to=iec-i --suffix=B $((FREED * 1024)))\" \ndf -h /\nEOF",
      "Run command: `chmod +x cleanup-space.sh && sudo ./cleanup-space.sh`",
      "AGENT: ''",
      "AGENT: '--- Bonus: Quick Commands Reference ---'",
      "AGENT: ''",
      "AGENT: 'Check disk usage:'",
      "AGENT: '  df -h                    Overall usage'",
      "AGENT: '  df -i                    Inode usage'",
      "AGENT: ''",
      "AGENT: 'Find large directories:'",
      "AGENT: '  du -h --max-depth=1 / | sort -hr'",
      "AGENT: '  du -sh /var/*  | sort -hr'",
      "AGENT: ''",
      "AGENT: 'Find large files:'",
      "AGENT: '  find / -size +1G -ls'",
      "AGENT: '  find / -size +100M -exec ls -lh {} \\;'",
      "AGENT: ''",
      "AGENT: 'Clean logs:'",
      "AGENT: '  journalctl --vacuum-size=1G'",
      "AGENT: '  find /var/log -name \"*.gz\" -delete'",
      "AGENT: ''",
      "AGENT: 'Clean caches:'",
      "AGENT: '  apt clean && apt autoremove'",
      "AGENT: '  docker system prune -a --volumes'",
      "AGENT: ''",
      "AGENT: 'Interactive:'",
      "AGENT: '  ncdu /'",
      "AGENT: ''",
      "AGENT: '✓ SOLUTION SUMMARY:'",
      "AGENT: '  ✓ Checked filesystem usage with df -h.'",
      "AGENT: '  ✓ Found largest directories with du and sort.'",
      "AGENT: '  ✓ Located large files with find command.'",
      "AGENT: '  ✓ Used ncdu for interactive disk exploration.'",
      "AGENT: '  ✓ Cleaned systemd journal with journalctl --vacuum.'",
      "AGENT: '  ✓ Removed package caches to free space.'",
      "AGENT: '  ✓ Deleted old log files and compressed logs.'",
      "AGENT: '  ✓ Cleaned Docker images and containers.'",
      "AGENT: '  ✓ Created automated cleanup scripts.'",
      "AGENT: '  ✓ Freed up significant disk space! 💾'"
    ],
    "commands": ["du", "df", "ncdu", "find", "journalctl"],
    "packages": {
      "debian_ubuntu": ["ncdu", "fdupes"],
      "arch": ["ncdu", "fdupes"]
    },
    "related_commands": ["df", "ls", "tree", "baobab"],
    "complexity": "intermediate",
    "tags": ["disk-usage", "du", "df", "ncdu", "find", "space-analysis", "cleanup", "logs", "storage"]
  }
]

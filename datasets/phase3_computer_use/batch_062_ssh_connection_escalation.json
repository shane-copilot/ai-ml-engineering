[
  {
    "id": "scenario_ssh_connection_multi_approach_001",
    "command": "ssh",
    "scenario": "Developer: Can't SSH to server for deployment",
    "problem": "SSH connection failing with various errors",
    "solution": "Diagnose and fix SSH connectivity issues",
    "steps": [
      "USER SAYS: 'I can\\'t SSH to my server for deployment!'",
      "AGENT: 'Let me troubleshoot the SSH connection...'",
      "AGENT: 'Approach 1: Try basic connection...'",
      "Try ssh: ssh user@192.168.1.100",
      "AGENT: 'ssh: connect to host 192.168.1.100 port 22: Connection refused ✗'",
      "AGENT: 'Connection refused - server not listening or blocked'",
      "AGENT: 'Approach 2: Check if server is reachable...'",
      "Ping server: ping -c 4 192.168.1.100",
      "AGENT: '64 bytes from 192.168.1.100: icmp_seq=1 ttl=64 time=1.2 ms ✓'",
      "AGENT: 'Server is reachable on network'",
      "Check ssh port: nc -zv 192.168.1.100 22",
      "AGENT: 'nc: connect to 192.168.1.100 port 22 (tcp) failed: Connection refused ✗'",
      "AGENT: 'Port 22 not open'",
      "AGENT: 'Approach 3: Try alternative SSH port...'",
      "Check 2222: nc -zv 192.168.1.100 2222",
      "AGENT: 'Connection to 192.168.1.100 2222 port [tcp/*] succeeded! ✓'",
      "AGENT: 'SSH running on port 2222!'",
      "Try ssh: ssh -p 2222 user@192.168.1.100",
      "AGENT: 'Permission denied (publickey) ✗'",
      "AGENT: 'Connected but authentication failed'",
      "USER: 'I have my SSH key!'",
      "AGENT: 'Approach 4: Specify key explicitly...'",
      "Try with key: ssh -p 2222 -i ~/.ssh/id_rsa user@192.168.1.100",
      "AGENT: 'Load key \"~/.ssh/id_rsa\": Permission denied ✗'",
      "AGENT: 'Key file permissions wrong'",
      "Check perms: ls -la ~/.ssh/id_rsa",
      "AGENT: '-rw-rw-rw- ~/.ssh/id_rsa ✗'",
      "AGENT: 'Too permissive! SSH requires 600'",
      "Fix perms: chmod 600 ~/.ssh/id_rsa",
      "AGENT: 'Key permissions fixed ✓'",
      "Fix dir: chmod 700 ~/.ssh",
      "AGENT: 'SSH directory permissions fixed ✓'",
      "Try again: ssh -p 2222 -i ~/.ssh/id_rsa user@192.168.1.100",
      "AGENT: 'Permission denied (publickey) ✗'",
      "AGENT: 'Still failing - key might not be authorized'",
      "AGENT: 'Approach 5: Check if correct key...'",
      "Show fingerprint: ssh-keygen -lf ~/.ssh/id_rsa.pub",
      "AGENT: '2048 SHA256:abc123... user@host (RSA)'",
      "AGENT: 'Key looks valid'",
      "USER: 'Maybe the server doesn\\'t have my key?'",
      "AGENT: 'Approach 6: Try password auth...'",
      "Try password: ssh -p 2222 -o PreferredAuthentications=password user@192.168.1.100",
      "AGENT: 'user@192.168.1.100 password: _'",
      "AGENT: 'user@server:~$ ✓'",
      "AGENT: 'Connected with password!'",
      "AGENT: 'Approach 7: Add SSH key to server...'",
      "Check authorized: cat ~/.ssh/authorized_keys",
      "AGENT: '(empty file) ✗'",
      "AGENT: 'No keys authorized!'",
      "Add key: echo 'ssh-rsa AAAAB3NzaC1yc2EAAA... user@host' >> ~/.ssh/authorized_keys",
      "AGENT: 'Key added ✓'",
      "Fix perms: chmod 600 ~/.ssh/authorized_keys",
      "chmod 700 ~/.ssh",
      "AGENT: 'Permissions set ✓'",
      "Logout: exit",
      "AGENT: 'Connection to 192.168.1.100 closed.'",
      "Try key: ssh -p 2222 -i ~/.ssh/id_rsa user@192.168.1.100",
      "AGENT: 'user@server:~$ ✓'",
      "AGENT: 'SSH key authentication working!'",
      "AGENT: 'Approach 8: Add to SSH config for convenience...'",
      "Create config: cat > ~/.ssh/config << 'EOF'",
      "Host myserver",
      "    HostName 192.168.1.100",
      "    Port 2222",
      "    User user",
      "    IdentityFile ~/.ssh/id_rsa",
      "    ServerAliveInterval 60",
      "    ServerAliveCountMax 3",
      "EOF",
      "Fix perms: chmod 600 ~/.ssh/config",
      "AGENT: 'SSH config created ✓'",
      "Test: ssh myserver",
      "AGENT: 'user@server:~$ ✓'",
      "AGENT: 'Now can connect with just: ssh myserver'",
      "AGENT: 'Approach 9: Use ssh-copy-id for easy key setup...'",
      "Show method: cat > ~/setup-ssh-key.sh << 'EOF'",
      "#!/bin/bash",
      "HOST=$1",
      "PORT=${2:-22}",
      "if [ -z \"$HOST\" ]; then",
      "  echo 'Usage: ./setup-ssh-key.sh user@host [port]'",
      "  exit 1",
      "fi",
      "echo 'Setting up SSH key authentication...'",
      "echo ''",
      "# Generate key if needed",
      "if [ ! -f ~/.ssh/id_rsa ]; then",
      "  echo 'Generating SSH key...'",
      "  ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_rsa -N ''",
      "  echo '✓ Key generated'",
      "fi",
      "# Copy key to server",
      "echo 'Copying key to server...'",
      "ssh-copy-id -p $PORT $HOST",
      "echo '✓ Key installed'",
      "echo ''",
      "echo 'Testing connection...'",
      "ssh -p $PORT $HOST 'echo \"✓ SSH working!\"'",
      "EOF",
      "chmod +x ~/setup-ssh-key.sh",
      "AGENT: 'Approach 10: Debug with verbose mode...'",
      "Show method: cat > ~/debug-ssh.sh << 'EOF'",
      "#!/bin/bash",
      "HOST=$1",
      "echo \"Debugging SSH connection to $HOST\"",
      "echo ''",
      "echo 'Level 1: Basic connectivity'",
      "ping -c 2 $HOST",
      "echo ''",
      "echo 'Level 2: Port scan'",
      "for port in 22 2222 22000; do",
      "  nc -zv -w 2 $HOST $port 2>&1 | grep -v 'failed'",
      "done",
      "echo ''",
      "echo 'Level 3: SSH verbose connection'",
      "ssh -vvv $HOST -o ConnectTimeout=5 2>&1 | grep -iE 'connect|auth|public|permission'",
      "EOF",
      "chmod +x ~/debug-ssh.sh",
      "Create comprehensive SSH helper: cat > ~/ssh-helper.sh << 'EOF'",
      "#!/bin/bash",
      "echo '=== SSH Connection Helper ==='",
      "echo ''",
      "echo '1. Test SSH connection'",
      "echo '2. Setup SSH key authentication'",
      "echo '3. Fix SSH key permissions'",
      "echo '4. Add host to SSH config'",
      "echo '5. Troubleshoot connection'",
      "echo '6. Start SSH server (local)'",
      "read -p 'Choice: ' OPT",
      "case $OPT in",
      "  1)",
      "    read -p 'Host: ' HOST",
      "    read -p 'Port [22]: ' PORT",
      "    PORT=${PORT:-22}",
      "    ssh -p $PORT -o ConnectTimeout=5 $HOST 'echo \"✓ Connection successful\"'",
      "    ;;",
      "  2)",
      "    read -p 'Host (user@server): ' HOST",
      "    read -p 'Port [22]: ' PORT",
      "    PORT=${PORT:-22}",
      "    if [ ! -f ~/.ssh/id_rsa ]; then",
      "      ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_rsa -N ''",
      "    fi",
      "    ssh-copy-id -p $PORT $HOST",
      "    ;;",
      "  3)",
      "    chmod 700 ~/.ssh",
      "    chmod 600 ~/.ssh/id_rsa ~/.ssh/config 2>/dev/null",
      "    chmod 644 ~/.ssh/id_rsa.pub ~/.ssh/known_hosts 2>/dev/null",
      "    echo '✓ SSH permissions fixed'",
      "    ls -la ~/.ssh/",
      "    ;;",
      "  4)",
      "    read -p 'Alias: ' ALIAS",
      "    read -p 'HostName: ' HOSTNAME",
      "    read -p 'Port [22]: ' PORT",
      "    PORT=${PORT:-22}",
      "    read -p 'User: ' USER",
      "    cat >> ~/.ssh/config << HOST",
      "",
      "Host $ALIAS",
      "    HostName $HOSTNAME",
      "    Port $PORT",
      "    User $USER",
      "    IdentityFile ~/.ssh/id_rsa",
      "HOST",
      "    echo \"✓ Added to config. Connect with: ssh $ALIAS\"",
      "    ;;",
      "  5)",
      "    read -p 'Host: ' HOST",
      "    echo ''",
      "    echo 'Testing connectivity...'",
      "    ping -c 2 $HOST",
      "    echo ''",
      "    echo 'Testing SSH ports...'",
      "    nc -zv -w 2 $HOST 22 2>&1",
      "    nc -zv -w 2 $HOST 2222 2>&1",
      "    echo ''",
      "    echo 'Verbose SSH connection:'",
      "    ssh -vvv $HOST -o ConnectTimeout=5 2>&1 | head -50",
      "    ;;",
      "  6)",
      "    sudo systemctl status sshd || sudo systemctl status ssh",
      "    echo ''",
      "    read -p 'Start/restart SSH? (y/n): ' START",
      "    if [ \"$START\" == 'y' ]; then",
      "      sudo systemctl restart sshd || sudo systemctl restart ssh",
      "      sudo systemctl enable sshd || sudo systemctl enable ssh",
      "      echo '✓ SSH server running'",
      "    fi",
      "    ;;",
      "esac",
      "EOF",
      "chmod +x ~/ssh-helper.sh",
      "Create SSH troubleshooter: cat > ~/troubleshoot-ssh.sh << 'EOF'",
      "#!/bin/bash",
      "HOST=$1",
      "PORT=${2:-22}",
      "echo \"=== SSH Troubleshooter: $HOST:$PORT ===\"",
      "echo ''",
      "echo 'Step 1: Network reachability'",
      "if ping -c 2 -W 2 $HOST >/dev/null 2>&1; then",
      "  echo '  ✓ Host is reachable'",
      "else",
      "  echo '  ✗ Host not reachable'",
      "  echo '    - Check network connection'",
      "  echo '    - Verify IP address'",
      "  echo '    - Check firewall'",
      "  exit 1",
      "fi",
      "echo ''",
      "echo 'Step 2: Port accessibility'",
      "if nc -zv -w 2 $HOST $PORT 2>&1 | grep -q succeeded; then",
      "  echo \"  ✓ Port $PORT is open\"",
      "else",
      "  echo \"  ✗ Port $PORT not accessible\"",
      "  echo '    Try alternate ports:'",
      "  for p in 22 2222 22000; do",
      "    nc -zv -w 1 $HOST $p 2>&1 | grep succeeded",
      "  done",
      "  exit 1",
      "fi",
      "echo ''",
      "echo 'Step 3: SSH key permissions'",
      "if [ -f ~/.ssh/id_rsa ]; then",
      "  PERM=$(stat -c '%a' ~/.ssh/id_rsa)",
      "  if [ \"$PERM\" == '600' ]; then",
      "    echo '  ✓ Private key permissions OK'",
      "  else",
      "    echo \"  ✗ Private key permissions: $PERM (should be 600)\"",
      "    chmod 600 ~/.ssh/id_rsa",
      "    echo '  ✓ Fixed'",
      "  fi",
      "else",
      "  echo '  ⚠️ No SSH key found'",
      "  echo '    Generate with: ssh-keygen -t rsa -b 4096'",
      "fi",
      "echo ''",
      "echo 'Step 4: Testing authentication'",
      "ssh -p $PORT -o ConnectTimeout=5 -o BatchMode=yes $HOST 'echo \"✓ Key auth works\"' 2>/dev/null",
      "if [ $? -eq 0 ]; then",
      "  echo '  ✓ SSH key authentication working'",
      "else",
      "  echo '  ✗ Key authentication failed'",
      "  echo '    - Copy key: ssh-copy-id -p $PORT $HOST'",
      "  echo '    - Or try password: ssh -p $PORT $HOST'",
      "fi",
      "EOF",
      "chmod +x ~/troubleshoot-ssh.sh",
      "AGENT: 'SSH connection fully working! ✓'",
      "AGENT: ''",
      "AGENT: 'Issues found and fixed:'",
      "AGENT: '  1. SSH on non-standard port (2222, not 22)'",
      "AGENT: '  2. SSH key permissions wrong (666 → 600)'",
      "AGENT: '  3. Key not in authorized_keys on server'",
      "AGENT: ''",
      "AGENT: 'Troubleshooting steps:'",
      "AGENT: '  1. Try connect → connection refused'",
      "AGENT: '  2. Ping server → reachable'",
      "AGENT: '  3. Check port 22 → closed'",
      "AGENT: '  4. Try port 2222 → open!'",
      "AGENT: '  5. Try SSH → permission denied'",
      "AGENT: '  6. Fix key perms → still denied'",
      "AGENT: '  7. Use password → connected'",
      "AGENT: '  8. Add key to server → key auth works'",
      "AGENT: '  9. Create SSH config → easy connection'",
      "AGENT: ''",
      "AGENT: 'Alternative approaches:'",
      "AGENT: '  9. Use ssh-copy-id for easy setup'",
      "AGENT: '  10. Debug with verbose mode (-vvv)'",
      "AGENT: ''",
      "AGENT: 'Tools created:'",
      "AGENT: '  ~/ssh-helper.sh - comprehensive SSH assistant'",
      "AGENT: '  ~/troubleshoot-ssh.sh <host> - diagnose connection'",
      "AGENT: '  ~/setup-ssh-key.sh <host> - easy key setup'",
      "AGENT: ''",
      "AGENT: 'Connect with: ssh myserver ✓'"
    ],
    "commands": ["ssh", "ssh-keygen", "ssh-copy-id", "nc"],
    "packages": {"debian_ubuntu": ["openssh-client", "netcat"], "arch": ["openssh", "gnu-netcat"]},
    "related_commands": ["ssh", "scp", "sftp", "ssh-keygen", "ssh-copy-id"],
    "complexity": "intermediate",
    "tags": ["ssh", "remote-access", "authentication", "keys", "multiple-approaches", "networking", "troubleshooting", "real-world", "ai-agent"]
  }
]

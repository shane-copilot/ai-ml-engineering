[
  {
    "id": "scenario_awk_log_analysis_096",
    "command": "awk",
    "scenario": "Analyze Apache access logs to find most frequent visitors and requested URLs.",
    "problem": "A sysadmin needs to analyze gigabytes of Apache access logs to identify potential attackers making excessive requests, find the most popular pages, and calculate average response times. Manual inspection is impossible.",
    "solution": "Use awk to parse log files, extract relevant fields (IP addresses, URLs, response codes, response times), perform aggregation and sorting, and generate a useful report.",
    "steps": [
      "USER SAYS: 'I have huge Apache access logs and need to find which IPs are hitting us the most and what pages they're requesting. How do I analyze this?'",
      "AGENT: 'AWK is perfect for log analysis! It's designed for processing text files line by line and can extract, aggregate, and analyze data incredibly fast. Let me show you some powerful log analysis patterns.'",
      "AGENT: ''",
      "AGENT: 'üîç RESEARCH PHASE: AWK for log file analysis...'",
      "AGENT: '[Searching] \"awk apache log analysis examples\"'",
      "AGENT: '[Found] AWK processes files line by line, splitting each line into fields ($1, $2, $3, etc.).'",
      "AGENT: '[Found] Associative arrays can count occurrences: `count[$field]++`'",
      "AGENT: '[Found] END block executes after processing all lines - perfect for printing results.'",
      "AGENT: '[Found] Can combine with sort for ranking: `| sort -nr | head -10`'",
      "AGENT: '‚úì Research complete! Let's analyze those logs.'",
      "AGENT: ''",
      "AGENT: '--- Approach 1: Understand Apache Log Format ---'",
      "Run command: `head -n 3 /var/log/apache2/access.log`",
      "AGENT: '192.168.1.100 - - [07/Oct/2025:14:23:15 +0000] \"GET /index.html HTTP/1.1\" 200 1234 \"-\" \"Mozilla/5.0\"'",
      "AGENT: '10.0.0.50 - - [07/Oct/2025:14:23:16 +0000] \"POST /api/login HTTP/1.1\" 401 89 \"-\" \"curl/7.68.0\"'",
      "AGENT: '192.168.1.100 - - [07/Oct/2025:14:23:17 +0000] \"GET /admin HTTP/1.1\" 403 512 \"-\" \"Mozilla/5.0\"'",
      "AGENT: ''",
      "AGENT: 'Format: IP - - [timestamp] \"METHOD URL PROTOCOL\" STATUS SIZE \"REFERRER\" \"USER-AGENT\"'",
      "AGENT: ''",
      "AGENT: '--- Approach 2: Find Top 10 IPs by Request Count ---'",
      "Run command: `awk '{print $1}' /var/log/apache2/access.log | sort | uniq -c | sort -nr | head -10`",
      "AGENT: '   1523 192.168.1.100'",
      "AGENT: '    847 10.0.0.50'",
      "AGENT: '    623 203.0.113.45'",
      "AGENT: '    412 198.51.100.78'",
      "AGENT: '    305 192.0.2.123'",
      "AGENT: '    287 10.0.0.89'",
      "AGENT: '    156 203.0.113.90'",
      "AGENT: '    134 192.168.1.200'",
      "AGENT: '     89 198.51.100.234'",
      "AGENT: '     67 192.0.2.45'",
      "AGENT: ''",
      "AGENT: 'üí° IP 192.168.1.100 made 1,523 requests - that's suspicious!'",
      "AGENT: ''",
      "AGENT: '--- Approach 3: Better - Use Pure AWK for Speed ---'",
      "Run command: `awk '{count[$1]++} END {for (ip in count) print count[ip], ip}' /var/log/apache2/access.log | sort -nr | head -10`",
      "AGENT: 'Same result but 3x faster on large files!'",
      "AGENT: ''",
      "AGENT: '--- Approach 4: Find Most Requested URLs ---'",
      "Run command: `awk '{print $7}' /var/log/apache2/access.log | sort | uniq -c | sort -nr | head -10`",
      "AGENT: '   2341 /index.html'",
      "AGENT: '   1876 /api/users'",
      "AGENT: '   1234 /admin'",
      "AGENT: '    987 /login'",
      "AGENT: '    765 /api/posts'",
      "AGENT: '    543 /dashboard'",
      "AGENT: '    432 /static/app.js'",
      "AGENT: '    321 /api/auth'",
      "AGENT: '    234 /search'",
      "AGENT: '    198 /profile'",
      "AGENT: ''",
      "AGENT: '--- Approach 5: Advanced - Find Failed Login Attempts ---'",
      "Run command: `awk '$7 ~ /login/ && $9 == \"401\" {print $1}' /var/log/apache2/access.log | sort | uniq -c | sort -nr | head -5`",
      "AGENT: '     89 10.0.0.50'",
      "AGENT: '     45 203.0.113.45'",
      "AGENT: '     23 192.168.1.100'",
      "AGENT: '     12 198.51.100.78'",
      "AGENT: '      8 192.0.2.123'",
      "AGENT: ''",
      "AGENT: 'üö® IP 10.0.0.50 has 89 failed login attempts - possible brute force attack!'",
      "AGENT: ''",
      "AGENT: '--- Approach 6: Calculate Average Response Size by Status Code ---'",
      "Run command: `awk '{status[$9]++; size[$9]+=$10} END {for (s in status) printf \"%s: %d requests, avg size: %.0f bytes\\n\", s, status[s], size[s]/status[s]}' /var/log/apache2/access.log`",
      "AGENT: '200: 8934 requests, avg size: 2341 bytes'",
      "AGENT: '404: 1245 requests, avg size: 512 bytes'",
      "AGENT: '401: 234 requests, avg size: 89 bytes'",
      "AGENT: '403: 156 requests, avg size: 512 bytes'",
      "AGENT: '500: 23 requests, avg size: 1024 bytes'",
      "AGENT: ''",
      "AGENT: '--- Approach 7: Find Requests During Specific Time Window ---'",
      "Run command: `awk '$4 ~ /07\\/Oct\\/2025:14:2[0-9]:/ {print $1, $7, $9}' /var/log/apache2/access.log | head -10`",
      "AGENT: '192.168.1.100 /index.html 200'",
      "AGENT: '10.0.0.50 /api/login 401'",
      "AGENT: '192.168.1.100 /admin 403'",
      "AGENT: '203.0.113.45 /api/users 200'",
      "AGENT: '...'",
      "AGENT: ''",
      "AGENT: '--- Approach 8: Complex Analysis - Requests Per Minute ---'",
      "Run command: `awk '{match($4, /\\[(.*):(..)\\//, time); print time[1] \":\" time[2]}' /var/log/apache2/access.log | uniq -c | tail -20`",
      "AGENT: '     45 07/Oct/2025:14:20'",
      "AGENT: '     52 07/Oct/2025:14:21'",
      "AGENT: '     48 07/Oct/2025:14:22'",
      "AGENT: '    189 07/Oct/2025:14:23  <-- SPIKE!'",
      "AGENT: '     51 07/Oct/2025:14:24'",
      "AGENT: '     49 07/Oct/2025:14:25'",
      "AGENT: ''",
      "AGENT: 'üí° Traffic spike at 14:23 with 189 requests/minute vs normal ~50!'",
      "AGENT: ''",
      "AGENT: '--- Approach 9: Create a Comprehensive Report Script ---'",
      "Create tool: `cat > analyze_logs.sh << 'EOF'`",
      "#!/bin/bash\n\nLOG_FILE=\"${1:-/var/log/apache2/access.log}\"\n\necho \"=== Apache Log Analysis Report ===\"\necho \"File: $LOG_FILE\"\necho \"Generated: $(date)\"\necho \"\"\n\necho \"Total Requests:\"\nwc -l < \"$LOG_FILE\"\necho \"\"\n\necho \"Top 5 IPs:\"\nawk '{count[$1]++} END {for (ip in count) print count[ip], ip}' \"$LOG_FILE\" | sort -nr | head -5\necho \"\"\n\necho \"Top 5 URLs:\"\nawk '{count[$7]++} END {for (url in count) print count[url], url}' \"$LOG_FILE\" | sort -nr | head -5\necho \"\"\n\necho \"Status Code Distribution:\"\nawk '{count[$9]++} END {for (code in count) printf \"%s: %d\\n\", code, count[code]}' \"$LOG_FILE\" | sort -k2 -nr\necho \"\"\n\necho \"Failed Login Attempts (401 on /login):\"\nawk '$7 ~ /login/ && $9 == \"401\" {count[$1]++} END {for (ip in count) print count[ip], ip}' \"$LOG_FILE\" | sort -nr | head -5\necho \"\"\n\necho \"Suspicious Activity (403 Forbidden):\"\nawk '$9 == \"403\" {count[$1]++} END {for (ip in count) print count[ip], ip}' \"$LOG_FILE\" | sort -nr | head -5\nEOF",
      "chmod +x analyze_logs.sh",
      "AGENT: ''",
      "AGENT: '--- Approach 10: Run the Report ---'",
      "Run command: `./analyze_logs.sh /var/log/apache2/access.log`",
      "AGENT: '=== Apache Log Analysis Report ==='",
      "AGENT: 'File: /var/log/apache2/access.log'",
      "AGENT: 'Generated: Mon Oct  7 14:30:00 UTC 2025'",
      "AGENT: ''",
      "AGENT: 'Total Requests:'",
      "AGENT: '12456'",
      "AGENT: ''",
      "AGENT: 'Top 5 IPs:'",
      "AGENT: '1523 192.168.1.100'",
      "AGENT: '847 10.0.0.50'",
      "AGENT: '623 203.0.113.45'",
      "AGENT: '412 198.51.100.78'",
      "AGENT: '305 192.0.2.123'",
      "AGENT: ''",
      "AGENT: 'Top 5 URLs:'",
      "AGENT: '2341 /index.html'",
      "AGENT: '1876 /api/users'",
      "AGENT: '1234 /admin'",
      "AGENT: '987 /login'",
      "AGENT: '765 /api/posts'",
      "AGENT: ''",
      "AGENT: 'Status Code Distribution:'",
      "AGENT: '200: 8934'",
      "AGENT: '404: 1245'",
      "AGENT: '401: 234'",
      "AGENT: '403: 156'",
      "AGENT: '500: 23'",
      "AGENT: ''",
      "AGENT: 'Failed Login Attempts (401 on /login):'",
      "AGENT: '89 10.0.0.50'",
      "AGENT: '45 203.0.113.45'",
      "AGENT: '23 192.168.1.100'",
      "AGENT: ''",
      "AGENT: 'Suspicious Activity (403 Forbidden):'",
      "AGENT: '78 192.168.1.100'",
      "AGENT: '34 10.0.0.50'",
      "AGENT: '23 203.0.113.45'",
      "AGENT: ''",
      "AGENT: '‚úì SOLUTION SUMMARY:'",
      "AGENT: '  ‚úì Used AWK to parse Apache access logs efficiently.'",
      "AGENT: '  ‚úì Identified top IPs making requests (potential attackers or power users).'",
      "AGENT: '  ‚úì Found most requested URLs to understand traffic patterns.'",
      "AGENT: '  ‚úì Detected failed login attempts indicating brute force attacks.'",
      "AGENT: '  ‚úì Analyzed HTTP status codes and response sizes.'",
      "AGENT: '  ‚úì Created reusable bash script for automated log analysis.'",
      "AGENT: '  ‚úì You can now analyze gigabytes of logs in seconds! üìä'"
    ],
    "commands": ["awk", "sort", "uniq", "head", "tail", "wc", "cat", "chmod", "bash"],
    "packages": {
      "debian_ubuntu": ["gawk", "coreutils"],
      "arch": ["gawk", "coreutils"]
    },
    "related_commands": ["sed", "grep", "cut", "tr"],
    "complexity": "intermediate",
    "tags": ["awk", "log-analysis", "text-processing", "apache", "security", "monitoring", "shell-scripting", "troubleshooting"]
  }
]

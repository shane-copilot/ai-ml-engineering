[
  {
    "id": "scenario_rsync_backup_sync_114",
    "command": "rsync",
    "scenario": "Efficiently sync and backup files with rsync for data protection and deployment.",
    "problem": "Need to backup large directories efficiently, sync files to remote server for deployment, and maintain incremental backups without copying unchanged files every time.",
    "solution": "Master rsync: understand transfer algorithms, use archive mode for complete backups, implement incremental backups with --link-dest, sync to remote servers over SSH, and exclude unnecessary files.",
    "steps": [
      "USER SAYS: 'I need to backup 500GB of data daily but copying everything takes hours. How can I backup only what changed?'",
      "AGENT: 'Rsync is the answer! It only transfers changed files and even changed parts of files. Perfect for efficient backups and deployments.'",
      "AGENT: ''",
      "AGENT: '🔍 RESEARCH PHASE: Rsync file synchronization...'",
      "AGENT: '[Searching] \"rsync tutorial backup incremental ssh archive mode\"'",
      "AGENT: '[Found] Rsync transfers only differences between source and destination.'",
      "AGENT: '[Found] `-a` (archive) mode preserves permissions, timestamps, symlinks.'",
      "AGENT: '[Found] `--link-dest` creates space-efficient incremental backups.'",
      "AGENT: '[Found] Works over SSH for remote backups.'",
      "AGENT: '✓ Research complete! Let's master efficient syncing.'",
      "AGENT: ''",
      "AGENT: '--- Approach 1: Basic Rsync ---'",
      "Run command: `rsync -av /source/dir/ /backup/dir/`",
      "AGENT: 'sending incremental file list'",
      "AGENT: 'file1.txt'",
      "AGENT: 'file2.txt'",
      "AGENT: 'subdir/file3.txt'",
      "AGENT: ''",
      "AGENT: 'sent 12,345 bytes  received 678 bytes  26,046.00 bytes/sec'",
      "AGENT: 'total size is 5,678,901  speedup is 436.84'",
      "AGENT: ''",
      "AGENT: 'Flags explained:'",
      "AGENT: '  -a = archive mode (preserves permissions, timestamps, etc.)'",
      "AGENT: '  -v = verbose (show files being transferred)'",
      "AGENT: ''",
      "AGENT: '💡 Note the trailing slash on source: /source/dir/ copies contents, /source/dir copies directory itself'",
      "AGENT: ''",
      "AGENT: '--- Approach 2: Dry Run (Test Without Changes) ---'",
      "Run command: `rsync -avn /source/dir/ /backup/dir/`",
      "AGENT: 'Shows what would be transferred without actually doing it'",
      "AGENT: '  -n = dry run (no changes made)'",
      "AGENT: ''",
      "AGENT: '--- Approach 3: Show Progress and Stats ---'",
      "Run command: `rsync -av --progress --stats /source/dir/ /backup/dir/`",
      "AGENT: 'sending incremental file list'",
      "AGENT: 'largefile.iso'",
      "AGENT: '    1,234,567,890  45%  123.45MB/s    0:00:08'",
      "AGENT: ''",
      "AGENT: 'Number of files: 1,234'",
      "AGENT: 'Number of regular files transferred: 567'",
      "AGENT: 'Total file size: 12.34G bytes'",
      "AGENT: 'Total transferred file size: 5.67G bytes'",
      "AGENT: 'Literal data: 5.67G bytes'",
      "AGENT: 'Matched data: 0 bytes'",
      "AGENT: 'Total bytes sent: 5.67G'",
      "AGENT: 'Total bytes received: 11.23K'",
      "AGENT: ''",
      "AGENT: '--- Approach 4: Sync to Remote Server over SSH ---'",
      "Run command: `rsync -avz -e ssh /local/dir/ user@remote-server:/remote/dir/`",
      "AGENT: '  -z = compress data during transfer'",
      "AGENT: '  -e ssh = use SSH for secure transfer'",
      "AGENT: ''",
      "Run command: `rsync -avz -e 'ssh -p 2222' /local/dir/ user@remote-server:/remote/dir/`",
      "AGENT: 'Use custom SSH port'",
      "AGENT: ''",
      "AGENT: '--- Approach 5: Exclude Files/Directories ---'",
      "Run command: `rsync -av --exclude='*.tmp' --exclude='node_modules/' /source/ /backup/`",
      "AGENT: 'Excludes temporary files and node_modules directories'",
      "AGENT: ''",
      "AGENT: 'Use exclude file:'",
      "Create tool: `cat > rsync-exclude.txt << 'EOF'`",
      "*.tmp\n*.log\nnode_modules/\n.git/\n__pycache__/\n*.pyc\n.DS_Store\nThumbs.db\nEOF",
      "AGENT: ''",
      "Run command: `rsync -av --exclude-from=rsync-exclude.txt /source/ /backup/`",
      "AGENT: ''",
      "AGENT: '--- Approach 6: Delete Files Not in Source ---'",
      "Run command: `rsync -av --delete /source/ /backup/`",
      "AGENT: '  --delete = removes files from destination that don\\'t exist in source'",
      "AGENT: ''",
      "AGENT: '⚠️ Be careful with --delete! Always test with --dry-run first'",
      "AGENT: ''",
      "AGENT: '--- Approach 7: Incremental Backups with Hard Links ---'",
      "Create tool: `cat > incremental-backup.sh << 'EOF'`",
      "#!/bin/bash\nset -euo pipefail\n\n# Configuration\nSOURCE=\"/home/user/data\"\nBACKUP_DIR=\"/backup\"\nDATE=$(date +%Y-%m-%d_%H-%M-%S)\nLATEST=\"$BACKUP_DIR/latest\"\nCURRENT=\"$BACKUP_DIR/$DATE\"\n\n# Create backup\nif [ -d \"$LATEST\" ]; then\n    # Incremental backup using hard links\n    rsync -av --delete --link-dest=\"$LATEST\" \"$SOURCE/\" \"$CURRENT/\"\nelse\n    # First backup\n    rsync -av \"$SOURCE/\" \"$CURRENT/\"\nfi\n\n# Update latest symlink\nrm -f \"$LATEST\"\nln -s \"$CURRENT\" \"$LATEST\"\n\necho \"Backup completed: $CURRENT\"\nEOF",
      "Run command: `chmod +x incremental-backup.sh`",
      "AGENT: ''",
      "Run command: `./incremental-backup.sh`",
      "AGENT: 'Backup completed: /backup/2025-10-08_15-30-00'",
      "AGENT: ''",
      "Run command: `ls -lh /backup/`",
      "AGENT: 'drwxr-xr-x 5 user user 4.0K Oct  8 15:30 2025-10-08_15-30-00  ← Full backup'",
      "AGENT: 'drwxr-xr-x 5 user user 4.0K Oct  8 16:30 2025-10-08_16-30-00  ← Only changed files, rest are hard links'",
      "AGENT: 'lrwxrwxrwx 1 user user   25 Oct  8 16:30 latest -> 2025-10-08_16-30-00'",
      "AGENT: ''",
      "Run command: `du -sh /backup/*`",
      "AGENT: '10G     /backup/2025-10-08_15-30-00  ← Full 10GB'",
      "AGENT: '150M    /backup/2025-10-08_16-30-00  ← Only 150MB (just changes!)'",
      "AGENT: ''",
      "AGENT: '✅ Incremental backup uses minimal space via hard links!'",
      "AGENT: ''",
      "AGENT: '--- Approach 8: Bandwidth Limiting ---'",
      "Run command: `rsync -av --bwlimit=1000 /source/ user@remote:/backup/`",
      "AGENT: 'Limits bandwidth to 1000 KB/s (1 MB/s)'",
      "AGENT: 'Useful to avoid saturating network connection'",
      "AGENT: ''",
      "AGENT: '--- Approach 9: Resume Interrupted Transfers ---'",
      "Run command: `rsync -av --partial --progress /large-file.iso user@remote:/backup/`",
      "AGENT: '  --partial = keeps partially transferred files'",
      "AGENT: '  Allows resuming if transfer is interrupted'",
      "AGENT: ''",
      "AGENT: 'Or use:'",
      "Run command: `rsync -avP /source/ /backup/`",
      "AGENT: '  -P = shorthand for --partial --progress'",
      "AGENT: ''",
      "AGENT: '--- Approach 10: Practical Backup Script ---'",
      "Create tool: `cat > backup-to-remote.sh << 'EOF'`",
      "#!/bin/bash\nset -euo pipefail\n\n# Configuration\nSOURCE=\"/var/www/myapp\"\nREMOTE_USER=\"backup\"\nREMOTE_HOST=\"backup-server.example.com\"\nREMOTE_DIR=\"/backups/$(hostname)\"\nLOG_FILE=\"/var/log/rsync-backup.log\"\nEXCLUDE_FILE=\"/etc/rsync-exclude.txt\"\n\n# Logging function\nlog() {\n    echo \"[$(date +'%Y-%m-%d %H:%M:%S')] $*\" | tee -a \"$LOG_FILE\"\n}\n\nlog \"=== Starting backup ===\"\nlog \"Source: $SOURCE\"\nlog \"Destination: $REMOTE_USER@$REMOTE_HOST:$REMOTE_DIR\"\n\n# Perform backup\nif rsync -avz --delete \\\n    --exclude-from=\"$EXCLUDE_FILE\" \\\n    --partial --progress \\\n    --stats \\\n    -e \"ssh -o StrictHostKeyChecking=no\" \\\n    \"$SOURCE/\" \\\n    \"$REMOTE_USER@$REMOTE_HOST:$REMOTE_DIR/\" \\\n    >> \"$LOG_FILE\" 2>&1; then\n    log \"SUCCESS: Backup completed\"\n    exit 0\nelse\n    log \"ERROR: Backup failed!\"\n    # Send alert email\n    echo \"Backup failed for $(hostname)\" | mail -s \"Backup Failure\" admin@example.com\n    exit 1\nfi\nEOF",
      "Run command: `chmod +x backup-to-remote.sh`",
      "AGENT: ''",
      "Run command: `sudo crontab -e`",
      "AGENT: 'Add:'",
      "AGENT: '0 2 * * * /usr/local/bin/backup-to-remote.sh'",
      "AGENT: ''",
      "AGENT: '✅ Automated daily backups at 2 AM!'",
      "AGENT: ''",
      "AGENT: '--- Bonus: Compare Directories ---'",
      "Run command: `rsync -avni /source/ /backup/ | grep '^>'`",
      "AGENT: 'Shows files that exist in source but not in backup'",
      "AGENT: '  -n = dry run'",
      "AGENT: '  -i = itemized changes'",
      "AGENT: ''",
      "AGENT: '--- Bonus: Mirror Website Deployment ---'",
      "Run command: `rsync -avz --delete /local/website/ user@webserver:/var/www/html/`",
      "AGENT: 'Perfect for deploying static websites'",
      "AGENT: ''",
      "AGENT: '✓ SOLUTION SUMMARY:'",
      "AGENT: '  ✓ Used rsync for efficient incremental file transfers.'",
      "AGENT: '  ✓ Implemented archive mode to preserve file attributes.'",
      "AGENT: '  ✓ Created space-efficient incremental backups with hard links.'",
      "AGENT: '  ✓ Synced to remote servers securely over SSH.'",
      "AGENT: '  ✓ Excluded unnecessary files to save time and space.'",
      "AGENT: '  ✓ Added bandwidth limiting and resume capability.'",
      "AGENT: '  ✓ Built automated backup script with logging and alerts.'",
      "AGENT: '  ✓ Your data is now protected with efficient backups! 💾'"
    ],
    "commands": ["rsync", "ssh", "cat", "chmod", "du", "crontab", "mail"],
    "packages": {
      "debian_ubuntu": ["rsync", "openssh-client"],
      "arch": ["rsync", "openssh"]
    },
    "related_commands": ["scp", "cp", "robocopy"],
    "complexity": "intermediate",
    "tags": ["rsync", "backup", "sync", "incremental", "ssh", "file-transfer", "automation", "disaster-recovery"]
  },
  {
    "id": "scenario_disk_management_lvm_115",
    "command": "lvm",
    "scenario": "Manage disk storage with LVM for flexible volume management and resizing.",
    "problem": "Server runs out of disk space. Need to add more storage, resize filesystems without downtime, and create snapshots for backups. Traditional partitioning is too rigid.",
    "solution": "Use LVM (Logical Volume Manager) to create flexible storage: physical volumes, volume groups, logical volumes. Resize online, create snapshots, and migrate data between disks.",
    "steps": [
      "USER SAYS: 'Our /var partition is full and we can't resize it. We added a new disk but don't know how to extend the filesystem without downtime.'",
      "AGENT: 'LVM is perfect for this! It provides flexible volume management. You can resize, add disks, create snapshots, all without downtime.'",
      "AGENT: ''",
      "AGENT: '🔍 RESEARCH PHASE: LVM storage management...'",
      "AGENT: '[Searching] \"lvm tutorial physical volume group logical volume resize\"'",
      "AGENT: '[Found] LVM hierarchy: Physical Volumes → Volume Groups → Logical Volumes.'",
      "AGENT: '[Found] Can resize logical volumes online (while mounted).'",
      "AGENT: '[Found] Snapshots allow consistent backups of active filesystems.'",
      "AGENT: '[Found] Can span logical volumes across multiple physical disks.'",
      "AGENT: '✓ Research complete! Let's manage storage flexibly.'",
      "AGENT: ''",
      "AGENT: '--- Approach 1: View Current Disk Setup ---'",
      "Run command: `lsblk`",
      "AGENT: 'NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT'",
      "AGENT: 'sda               8:0    0  100G  0 disk'",
      "AGENT: '├─sda1            8:1    0    1G  0 part /boot'",
      "AGENT: '└─sda2            8:2    0   99G  0 part'",
      "AGENT: '  ├─vg0-root    254:0    0   50G  0 lvm  /'",
      "AGENT: '  ├─vg0-var     254:1    0   30G  0 lvm  /var  ← FULL!'",
      "AGENT: '  └─vg0-swap    254:2    0   19G  0 lvm  [SWAP]'",
      "AGENT: 'sdb               8:16   0  200G  0 disk           ← New disk'",
      "AGENT: ''",
      "AGENT: 'Check free space:'",
      "Run command: `df -h /var`",
      "AGENT: 'Filesystem           Size  Used Avail Use% Mounted on'",
      "AGENT: '/dev/mapper/vg0-var   30G   29G  100M  99% /var  ← Almost full!'",
      "AGENT: ''",
      "AGENT: '--- Approach 2: View LVM Configuration ---'",
      "Run command: `sudo pvs`",
      "AGENT: '  PV         VG  Fmt  Attr PSize   PFree'",
      "AGENT: '  /dev/sda2  vg0 lvm2 a--   99.00g    0'",
      "AGENT: ''",
      "Run command: `sudo vgs`",
      "AGENT: '  VG  #PV #LV #SN Attr   VSize   VFree'",
      "AGENT: '  vg0   1   3   0 wz--n-  99.00g    0'",
      "AGENT: ''",
      "Run command: `sudo lvs`",
      "AGENT: '  LV   VG  Attr       LSize  Pool Origin Data%  Meta%'",
      "AGENT: '  root vg0 -wi-ao---- 50.00g'",
      "AGENT: '  swap vg0 -wi-ao---- 19.00g'",
      "AGENT: '  var  vg0 -wi-ao---- 30.00g'",
      "AGENT: ''",
      "AGENT: 'LVM Hierarchy:'",
      "AGENT: '  Physical Volume (PV) = /dev/sda2 (99GB)'",
      "AGENT: '    └─ Volume Group (VG) = vg0 (99GB, 0 free)'",
      "AGENT: '         ├─ Logical Volume (LV) = root (50GB)'",
      "AGENT: '         ├─ Logical Volume (LV) = var (30GB) ← Need to extend'",
      "AGENT: '         └─ Logical Volume (LV) = swap (19GB)'",
      "AGENT: ''",
      "AGENT: '--- Approach 3: Add New Disk as Physical Volume ---'",
      "Run command: `sudo pvcreate /dev/sdb`",
      "AGENT: '  Physical volume \"/dev/sdb\" successfully created.'",
      "AGENT: ''",
      "Run command: `sudo pvs`",
      "AGENT: '  PV         VG  Fmt  Attr PSize   PFree'",
      "AGENT: '  /dev/sda2  vg0 lvm2 a--   99.00g      0'",
      "AGENT: '  /dev/sdb       lvm2 ---  200.00g 200.00g  ← New PV'",
      "AGENT: ''",
      "AGENT: '--- Approach 4: Extend Volume Group ---'",
      "Run command: `sudo vgextend vg0 /dev/sdb`",
      "AGENT: '  Volume group \"vg0\" successfully extended'",
      "AGENT: ''",
      "Run command: `sudo vgs`",
      "AGENT: '  VG  #PV #LV #SN Attr   VSize   VFree'",
      "AGENT: '  vg0   2   3   0 wz--n- 298.99g 200.00g  ← Now has free space!'",
      "AGENT: ''",
      "AGENT: '--- Approach 5: Extend Logical Volume ---'",
      "Run command: `sudo lvextend -L +50G /dev/vg0/var`",
      "AGENT: '  Size of logical volume vg0/var changed from 30.00 GiB to 80.00 GiB.'",
      "AGENT: '  Logical volume vg0/var successfully resized.'",
      "AGENT: ''",
      "AGENT: 'Or extend to use all free space:'",
      "Run command: `sudo lvextend -l +100%FREE /dev/vg0/var`",
      "AGENT: ''",
      "AGENT: '--- Approach 6: Resize Filesystem ---'",
      "AGENT: 'For ext4 filesystem (online resize):'",
      "Run command: `sudo resize2fs /dev/vg0/var`",
      "AGENT: 'resize2fs 1.46.5 (30-Dec-2021)'",
      "AGENT: 'Filesystem at /dev/vg0/var is mounted on /var; on-line resizing required'",
      "AGENT: 'old_desc_blocks = 4, new_desc_blocks = 10'",
      "AGENT: 'The filesystem on /dev/vg0/var is now 20971520 (4k) blocks long.'",
      "AGENT: ''",
      "Run command: `df -h /var`",
      "AGENT: 'Filesystem           Size  Used Avail Use% Mounted on'",
      "AGENT: '/dev/mapper/vg0-var   80G   29G   47G  39% /var  ← Resized online!'",
      "AGENT: ''",
      "AGENT: '✅ Extended /var from 30GB to 80GB with ZERO downtime!'",
      "AGENT: ''",
      "AGENT: '--- Approach 7: Create Snapshot for Backup ---'",
      "Run command: `sudo lvcreate -L 10G -s -n var_snapshot /dev/vg0/var`",
      "AGENT: '  Logical volume \"var_snapshot\" created.'",
      "AGENT: ''",
      "Run command: `sudo lvs`",
      "AGENT: '  LV           VG  Attr       LSize  Pool Origin Data%'",
      "AGENT: '  root         vg0 -wi-ao---- 50.00g'",
      "AGENT: '  swap         vg0 -wi-ao---- 19.00g'",
      "AGENT: '  var          vg0 owi-aos--- 80.00g'",
      "AGENT: '  var_snapshot vg0 swi-a-s--- 10.00g      var   0.00  ← Snapshot'",
      "AGENT: ''",
      "AGENT: 'Mount snapshot for backup:'",
      "Run command: `sudo mkdir /mnt/var_snapshot`",
      "Run command: `sudo mount -o ro /dev/vg0/var_snapshot /mnt/var_snapshot`",
      "AGENT: ''",
      "Run command: `sudo tar czf /backup/var_$(date +%Y%m%d).tar.gz -C /mnt/var_snapshot .`",
      "AGENT: ''",
      "Run command: `sudo umount /mnt/var_snapshot`",
      "Run command: `sudo lvremove -f /dev/vg0/var_snapshot`",
      "AGENT: '  Logical volume \"var_snapshot\" successfully removed'",
      "AGENT: ''",
      "AGENT: '✅ Consistent backup created while system is running!'",
      "AGENT: ''",
      "AGENT: '--- Approach 8: Create New Logical Volume ---'",
      "Run command: `sudo lvcreate -L 100G -n data vg0`",
      "AGENT: '  Logical volume \"data\" created.'",
      "AGENT: ''",
      "Run command: `sudo mkfs.ext4 /dev/vg0/data`",
      "AGENT: 'Creating filesystem with 26214400 4k blocks'",
      "AGENT: 'done'",
      "AGENT: ''",
      "Run command: `sudo mkdir /data`",
      "Run command: `sudo mount /dev/vg0/data /data`",
      "AGENT: ''",
      "AGENT: 'Make permanent in /etc/fstab:'",
      "Run command: `echo '/dev/vg0/data /data ext4 defaults 0 2' | sudo tee -a /etc/fstab`",
      "AGENT: ''",
      "AGENT: '--- Approach 9: Remove/Shrink Logical Volume ---'",
      "AGENT: '⚠️ Shrinking requires unmounting!'",
      "Run command: `sudo umount /data`",
      "Run command: `sudo e2fsck -f /dev/vg0/data`",
      "Run command: `sudo resize2fs /dev/vg0/data 50G`",
      "Run command: `sudo lvreduce -L 50G /dev/vg0/data`",
      "AGENT: '  WARNING: Reducing active logical volume to 50.00 GiB.'",
      "AGENT: '  THIS MAY DESTROY YOUR DATA (filesystem etc.)'",
      "AGENT: 'Do you really want to reduce vg0/data? [y/n]: y'",
      "AGENT: '  Size of logical volume vg0/data changed from 100.00 GiB to 50.00 GiB.'",
      "AGENT: ''",
      "Run command: `sudo mount /dev/vg0/data /data`",
      "AGENT: ''",
      "AGENT: '--- Approach 10: View Detailed Info ---'",
      "Run command: `sudo lvdisplay /dev/vg0/var`",
      "AGENT: '  --- Logical volume ---'",
      "AGENT: '  LV Path                /dev/vg0/var'",
      "AGENT: '  LV Name                var'",
      "AGENT: '  VG Name                vg0'",
      "AGENT: '  LV UUID                abc123-def456-...'",
      "AGENT: '  LV Write Access        read/write'",
      "AGENT: '  LV Status              available'",
      "AGENT: '  # open                 1'",
      "AGENT: '  LV Size                80.00 GiB'",
      "AGENT: '  Current LE             20480'",
      "AGENT: '  Segments               2'",
      "AGENT: '  Allocation             inherit'",
      "AGENT: '  Read ahead sectors     auto'",
      "AGENT: '  Block device           254:1'",
      "AGENT: ''",
      "AGENT: '✓ SOLUTION SUMMARY:'",
      "AGENT: '  ✓ Added new physical disk to LVM pool.'",
      "AGENT: '  ✓ Extended volume group with additional storage.'",
      "AGENT: '  ✓ Extended logical volume and resized filesystem ONLINE (no downtime).'",
      "AGENT: '  ✓ Created consistent snapshots for backups while system running.'",
      "AGENT: '  ✓ Created new logical volumes for additional storage needs.'",
      "AGENT: '  ✓ Learned to shrink volumes (requires unmounting).'",
      "AGENT: '  ✓ Understood LVM hierarchy: PV → VG → LV.'",
      "AGENT: '  ✓ You now have flexible, manageable storage! 💽'"
    ],
    "commands": ["lvm", "pvcreate", "vgcreate", "vgextend", "lvcreate", "lvextend", "lvreduce", "resize2fs", "mkfs.ext4", "mount", "lsblk", "df"],
    "packages": {
      "debian_ubuntu": ["lvm2", "e2fsprogs"],
      "arch": ["lvm2", "e2fsprogs"]
    },
    "related_commands": ["fdisk", "parted", "zfs"],
    "complexity": "advanced",
    "tags": ["lvm", "disk-management", "storage", "filesystem", "resize", "snapshot", "backup", "system-administration"]
  }
]

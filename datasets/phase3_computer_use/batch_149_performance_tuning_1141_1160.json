[
  {
    "id": "scenario_performance_tuning_147",
    "command": "sysctl",
    "scenario": "Optimize Linux system performance by tuning kernel parameters and system settings.",
    "problem": "Need to improve system performance, optimize network settings, increase file descriptor limits, tune memory management, configure TCP/IP stack, adjust kernel parameters for databases/applications, and make performance optimizations persistent across reboots.",
    "solution": "Use sysctl to view and modify kernel parameters, understand key performance settings, optimize network buffers, file limits, memory management, create /etc/sysctl.conf for persistence, and tune system for specific workloads.",
    "steps": [
      "USER SAYS: 'My system is slow and applications are hitting limits. How do I tune Linux kernel parameters to improve performance?'",
      "AGENT: 'Let me show you system performance tuning with sysctl! We'll optimize kernel parameters, network settings, file limits, and memory management.'",
      "AGENT: ''",
      "AGENT: 'üîç RESEARCH PHASE: Linux performance tuning...'",
      "AGENT: '[Searching] \"linux sysctl kernel tuning performance optimization\"'",
      "AGENT: '[Found] sysctl -a shows all kernel parameters.'",
      "AGENT: '[Found] /etc/sysctl.conf for persistent settings.'",
      "AGENT: '[Found] ulimit for per-process limits, sysctl for system-wide.'",
      "AGENT: '[Found] Key areas: network, file descriptors, memory, TCP.'",
      "AGENT: '‚úì Research complete! Let's optimize performance.'",
      "AGENT: ''",
      "AGENT: '--- Approach 1: View Current Settings ---'",
      "Run command: `sysctl -a | head -20`",
      "AGENT: 'abi.vsyscall32 = 1'",
      "AGENT: 'debug.exception-trace = 1'",
      "AGENT: 'dev.cdrom.autoclose = 1'",
      "AGENT: 'fs.file-max = 9223372036854775807'",
      "AGENT: '...'",
      "AGENT: 'Shows all kernel parameters (-a = all)'",
      "AGENT: ''",
      "Run command: `sysctl fs.file-max`",
      "AGENT: 'fs.file-max = 9223372036854775807'",
      "AGENT: 'View specific parameter'",
      "AGENT: ''",
      "Run command: `sysctl -a | grep file`",
      "AGENT: 'fs.file-max = 9223372036854775807'",
      "AGENT: 'fs.file-nr = 1234 0 9223372036854775807'",
      "AGENT: 'Search parameters by keyword'",
      "AGENT: ''",
      "AGENT: '--- Approach 2: Temporary Changes (Until Reboot) ---'",
      "Run command: `sudo sysctl fs.file-max=1000000`",
      "AGENT: 'fs.file-max = 1000000'",
      "AGENT: 'Changes value temporarily'",
      "AGENT: ''",
      "Run command: `sudo sysctl -w net.ipv4.ip_forward=1`",
      "AGENT: '  -w = Write (set value)'",
      "AGENT: 'net.ipv4.ip_forward = 1'",
      "AGENT: ''",
      "AGENT: '--- Approach 3: Permanent Changes (/etc/sysctl.conf) ---'",
      "Run command: `sudo nano /etc/sysctl.conf`",
      "AGENT: '# Add at end of file:'",
      "AGENT: 'fs.file-max = 1000000'",
      "AGENT: 'net.ipv4.ip_forward = 1'",
      "AGENT: ''",
      "Run command: `sudo sysctl -p`",
      "AGENT: '  -p = Load settings from /etc/sysctl.conf'",
      "AGENT: 'fs.file-max = 1000000'",
      "AGENT: 'net.ipv4.ip_forward = 1'",
      "AGENT: 'Settings applied and will persist after reboot'",
      "AGENT: ''",
      "AGENT: 'Or load specific file:'",
      "Run command: `sudo sysctl -p /etc/sysctl.d/99-custom.conf`",
      "AGENT: ''",
      "AGENT: '--- Approach 4: File Descriptor Limits ---'",
      "Run command: `sysctl fs.file-max`",
      "AGENT: 'fs.file-max = 9223372036854775807'",
      "AGENT: 'System-wide max open files'",
      "AGENT: ''",
      "Run command: `cat /proc/sys/fs/file-nr`",
      "AGENT: '1234    0    9223372036854775807'",
      "AGENT: '   ^    ^    ^'",
      "AGENT: '   |    |    |'",
      "AGENT: 'Open  Free  Max'",
      "AGENT: ''",
      "Run command: `ulimit -n`",
      "AGENT: '1024'",
      "AGENT: 'Per-process limit (current user)'",
      "AGENT: ''",
      "AGENT: 'Increase limits:'",
      "Create tool: `sudo tee -a /etc/sysctl.conf << 'EOF'`",
      "# Increase file descriptor limits\nfs.file-max = 2000000\nfs.nr_open = 2000000\nEOF",
      "AGENT: ''",
      "Run command: `sudo sysctl -p`",
      "AGENT: ''",
      "AGENT: 'Also update /etc/security/limits.conf:'",
      "Create tool: `sudo tee -a /etc/security/limits.conf << 'EOF'`",
      "*  soft  nofile  100000\n*  hard  nofile  100000\nEOF",
      "AGENT: ''",
      "AGENT: '--- Approach 5: Network Performance ---'",
      "AGENT: ''",
      "AGENT: 'TCP buffer sizes:'",
      "Create tool: `sudo tee -a /etc/sysctl.conf << 'EOF'`",
      "# Network performance tuning\n\n# Increase TCP buffer sizes\nnet.core.rmem_max = 134217728\nnet.core.wmem_max = 134217728\nnet.core.rmem_default = 16777216\nnet.core.wmem_default = 16777216\n\n# TCP memory\nnet.ipv4.tcp_rmem = 4096 87380 134217728\nnet.ipv4.tcp_wmem = 4096 65536 134217728\n\n# Increase connection backlog\nnet.core.somaxconn = 4096\nnet.ipv4.tcp_max_syn_backlog = 8192\n\n# Enable TCP window scaling\nnet.ipv4.tcp_window_scaling = 1\n\n# Increase local port range\nnet.ipv4.ip_local_port_range = 10000 65535\nEOF",
      "Run command: `sudo sysctl -p`",
      "AGENT: ''",
      "AGENT: '--- Approach 6: Memory Management ---'",
      "Create tool: `sudo tee -a /etc/sysctl.conf << 'EOF'`",
      "# Memory management\n\n# Swappiness (0-100, lower = less swapping)\nvm.swappiness = 10\n\n# Dirty pages (when to write to disk)\nvm.dirty_ratio = 15\nvm.dirty_background_ratio = 5\n\n# VFS cache pressure\nvm.vfs_cache_pressure = 50\n\n# Overcommit memory\nvm.overcommit_memory = 1\nvm.overcommit_ratio = 50\nEOF",
      "Run command: `sudo sysctl -p`",
      "AGENT: ''",
      "Run command: `sysctl vm.swappiness`",
      "AGENT: 'vm.swappiness = 10'",
      "AGENT: '  Lower value = prefer RAM over swap'",
      "AGENT: '  Good for systems with lots of RAM'",
      "AGENT: ''",
      "AGENT: '--- Approach 7: TCP/IP Stack Tuning ---'",
      "Create tool: `sudo tee -a /etc/sysctl.conf << 'EOF'`",
      "# TCP/IP optimizations\n\n# Fast recycling of TIME_WAIT sockets\nnet.ipv4.tcp_tw_reuse = 1\n\n# Protect against SYN flood attacks\nnet.ipv4.tcp_syncookies = 1\n\n# Increase netdev backlog\nnet.core.netdev_max_backlog = 5000\n\n# TCP keepalive\nnet.ipv4.tcp_keepalive_time = 600\nnet.ipv4.tcp_keepalive_intvl = 60\nnet.ipv4.tcp_keepalive_probes = 3\n\n# TCP congestion control\nnet.ipv4.tcp_congestion_control = bbr\nEOF",
      "Run command: `sudo sysctl -p`",
      "AGENT: ''",
      "AGENT: '--- Approach 8: Database Server Tuning ---'",
      "Create tool: `sudo tee /etc/sysctl.d/99-database.conf << 'EOF'`",
      "# Optimizations for database servers (PostgreSQL, MySQL, MongoDB)\n\n# Shared memory\nkernel.shmmax = 68719476736\nkernel.shmall = 4294967296\nkernel.shmmni = 4096\n\n# Semaphores (for PostgreSQL)\nkernel.sem = 250 32000 100 128\n\n# Message queues\nkernel.msgmnb = 65536\nkernel.msgmax = 65536\n\n# File descriptors\nfs.file-max = 2000000\n\n# Memory\nvm.swappiness = 1\nvm.dirty_ratio = 80\nvm.dirty_background_ratio = 5\nvm.overcommit_memory = 2\nvm.overcommit_ratio = 95\nEOF",
      "Run command: `sudo sysctl -p /etc/sysctl.d/99-database.conf`",
      "AGENT: ''",
      "AGENT: '--- Approach 9: Web Server Tuning ---'",
      "Create tool: `sudo tee /etc/sysctl.d/99-webserver.conf << 'EOF'`",
      "# Optimizations for web servers (Nginx, Apache)\n\n# File descriptors\nfs.file-max = 1000000\n\n# Network\nnet.core.somaxconn = 65535\nnet.ipv4.tcp_max_syn_backlog = 20000\nnet.ipv4.ip_local_port_range = 1024 65535\n\n# TCP buffers\nnet.core.rmem_max = 16777216\nnet.core.wmem_max = 16777216\nnet.ipv4.tcp_rmem = 4096 87380 16777216\nnet.ipv4.tcp_wmem = 4096 65536 16777216\n\n# Connection handling\nnet.ipv4.tcp_fin_timeout = 15\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.tcp_max_tw_buckets = 2000000\n\n# Keep alive\nnet.ipv4.tcp_keepalive_time = 300\nnet.ipv4.tcp_keepalive_intvl = 30\nnet.ipv4.tcp_keepalive_probes = 3\nEOF",
      "Run command: `sudo sysctl -p /etc/sysctl.d/99-webserver.conf`",
      "AGENT: ''",
      "AGENT: '--- Approach 10: Security Hardening ---'",
      "Create tool: `sudo tee /etc/sysctl.d/99-security.conf << 'EOF'`",
      "# Security hardening\n\n# IP forwarding (disable if not router)\nnet.ipv4.ip_forward = 0\nnet.ipv6.conf.all.forwarding = 0\n\n# SYN cookies (DDoS protection)\nnet.ipv4.tcp_syncookies = 1\n\n# Ignore ICMP redirects\nnet.ipv4.conf.all.accept_redirects = 0\nnet.ipv6.conf.all.accept_redirects = 0\n\n# Ignore source-routed packets\nnet.ipv4.conf.all.accept_source_route = 0\nnet.ipv6.conf.all.accept_source_route = 0\n\n# Log martian packets\nnet.ipv4.conf.all.log_martians = 1\n\n# Ignore ICMP ping\nnet.ipv4.icmp_echo_ignore_all = 0\n\n# Reverse path filtering\nnet.ipv4.conf.all.rp_filter = 1\n\n# Disable IPv6 (if not needed)\n# net.ipv6.conf.all.disable_ipv6 = 1\n# net.ipv6.conf.default.disable_ipv6 = 1\nEOF",
      "Run command: `sudo sysctl -p /etc/sysctl.d/99-security.conf`",
      "AGENT: ''",
      "AGENT: '--- Bonus: View Current Usage ---'",
      "Run command: `cat /proc/sys/fs/file-nr`",
      "AGENT: 'Currently open files vs max'",
      "AGENT: ''",
      "Run command: `free -h`",
      "AGENT: 'Memory usage'",
      "AGENT: ''",
      "Run command: `sysctl vm.swappiness vm.dirty_ratio`",
      "AGENT: 'vm.swappiness = 10'",
      "AGENT: 'vm.dirty_ratio = 15'",
      "AGENT: ''",
      "Run command: `netstat -s | grep -i listen`",
      "AGENT: 'Network statistics'",
      "AGENT: ''",
      "Run command: `ss -s`",
      "AGENT: 'Total: 234 (kernel 0)'",
      "AGENT: 'TCP:   123 (estab 45, closed 10, ...)'",
      "AGENT: 'Socket statistics'",
      "AGENT: ''",
      "AGENT: '--- Bonus: Performance Monitoring ---'",
      "Run command: `watch -n 1 'cat /proc/sys/fs/file-nr'`",
      "AGENT: 'Monitor open files in real-time'",
      "AGENT: ''",
      "Run command: `sar -r 1 5`",
      "AGENT: 'Memory utilization (requires sysstat)'",
      "AGENT: ''",
      "Run command: `sar -n DEV 1 5`",
      "AGENT: 'Network statistics'",
      "AGENT: ''",
      "AGENT: '--- Bonus: Complete Tuning Script ---'",
      "Create tool: `cat > tune-system.sh << 'EOF'`",
      "#!/bin/bash\nset -euo pipefail\n\nif [ \"$(id -u)\" -ne 0 ]; then\n    echo \"Must run as root\"\n    exit 1\nfi\n\necho \"Applying system performance tuning...\"\n\n# Backup current settings\ncp /etc/sysctl.conf /etc/sysctl.conf.backup.$(date +%Y%m%d)\n\n# Create tuning file\ncat > /etc/sysctl.d/99-performance.conf << 'EOT'\n# Performance tuning by tune-system.sh\n\n# File descriptors\nfs.file-max = 2000000\nfs.nr_open = 2000000\n\n# Network buffers\nnet.core.rmem_max = 134217728\nnet.core.wmem_max = 134217728\nnet.ipv4.tcp_rmem = 4096 87380 134217728\nnet.ipv4.tcp_wmem = 4096 65536 134217728\n\n# Connection handling\nnet.core.somaxconn = 65535\nnet.ipv4.tcp_max_syn_backlog = 20000\nnet.ipv4.ip_local_port_range = 10000 65535\nnet.ipv4.tcp_tw_reuse = 1\n\n# Memory\nvm.swappiness = 10\nvm.dirty_ratio = 15\nvm.dirty_background_ratio = 5\n\n# Security\nnet.ipv4.tcp_syncookies = 1\nnet.ipv4.conf.all.rp_filter = 1\nEOT\n\n# Apply settings\nsysctl -p /etc/sysctl.d/99-performance.conf\n\necho \"\"\necho \"‚úì System tuning applied!\"\necho \"Changes will persist after reboot.\"\nEOF",
      "Run command: `chmod +x tune-system.sh`",
      "Run command: `sudo ./tune-system.sh`",
      "AGENT: ''",
      "AGENT: '--- Bonus: Key Parameters Reference ---'",
      "AGENT: ''",
      "AGENT: 'File System:'",
      "AGENT: '  fs.file-max              Max open files (system-wide)'",
      "AGENT: '  fs.nr_open               Max open files per process'",
      "AGENT: '  fs.inotify.max_user_watches  File watches (IDEs, sync tools)'",
      "AGENT: ''",
      "AGENT: 'Network Buffers:'",
      "AGENT: '  net.core.rmem_max        Max receive buffer'",
      "AGENT: '  net.core.wmem_max        Max send buffer'",
      "AGENT: '  net.ipv4.tcp_rmem        TCP receive buffer (min default max)'",
      "AGENT: '  net.ipv4.tcp_wmem        TCP send buffer (min default max)'",
      "AGENT: ''",
      "AGENT: 'Connection Handling:'",
      "AGENT: '  net.core.somaxconn       Listen backlog'",
      "AGENT: '  net.ipv4.tcp_max_syn_backlog  SYN backlog'",
      "AGENT: '  net.ipv4.ip_local_port_range  Available ports'",
      "AGENT: ''",
      "AGENT: 'Memory:'",
      "AGENT: '  vm.swappiness            Swap tendency (0-100)'",
      "AGENT: '  vm.dirty_ratio           Max dirty pages %'",
      "AGENT: '  vm.dirty_background_ratio  Background flush %'",
      "AGENT: '  vm.overcommit_memory     Memory overcommit policy'",
      "AGENT: ''",
      "AGENT: 'TCP:'",
      "AGENT: '  net.ipv4.tcp_tw_reuse    Reuse TIME_WAIT sockets'",
      "AGENT: '  net.ipv4.tcp_fin_timeout TIME_WAIT timeout'",
      "AGENT: '  net.ipv4.tcp_keepalive_time  Keepalive interval'",
      "AGENT: ''",
      "AGENT: '--- Bonus: Workload-Specific Recommendations ---'",
      "AGENT: ''",
      "AGENT: 'High-traffic web server:'",
      "AGENT: '  - Increase net.core.somaxconn to 65535'",
      "AGENT: '  - Set net.ipv4.tcp_tw_reuse = 1'",
      "AGENT: '  - Increase file descriptors'",
      "AGENT: '  - Lower vm.swappiness'",
      "AGENT: ''",
      "AGENT: 'Database server:'",
      "AGENT: '  - Set vm.swappiness = 1'",
      "AGENT: '  - Increase shared memory (kernel.shmmax)'",
      "AGENT: '  - Higher vm.dirty_ratio'",
      "AGENT: '  - Disable transparent hugepages'",
      "AGENT: ''",
      "AGENT: 'Desktop/Laptop:'",
      "AGENT: '  - vm.swappiness = 60 (default is fine)'",
      "AGENT: '  - Enable laptop_mode for battery'",
      "AGENT: '  - Standard TCP settings'",
      "AGENT: ''",
      "AGENT: '‚úì SOLUTION SUMMARY:'",
      "AGENT: '  ‚úì Viewed kernel parameters with sysctl -a.'",
      "AGENT: '  ‚úì Made temporary changes with sysctl -w.'",
      "AGENT: '  ‚úì Created persistent settings in /etc/sysctl.conf.'",
      "AGENT: '  ‚úì Increased file descriptor limits for high load.'",
      "AGENT: '  ‚úì Optimized network buffers and TCP settings.'",
      "AGENT: '  ‚úì Tuned memory management (swappiness, dirty pages).'",
      "AGENT: '  ‚úì Applied workload-specific optimizations.'",
      "AGENT: '  ‚úì Implemented security hardening parameters.'",
      "AGENT: '  ‚úì Created tuning scripts for reproducibility.'",
      "AGENT: '  ‚úì You now master Linux performance tuning! ‚ö°'"
    ],
    "commands": ["sysctl", "ulimit", "free", "ss"],
    "packages": {
      "debian_ubuntu": ["procps"],
      "arch": ["procps-ng"]
    },
    "related_commands": ["ulimit", "nice", "ionice", "tuned"],
    "complexity": "advanced",
    "tags": ["sysctl", "performance-tuning", "kernel-parameters", "optimization", "network-tuning", "memory-management", "file-descriptors", "tcp-tuning"]
  }
]

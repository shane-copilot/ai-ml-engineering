[
  {
    "id": "scenario_ssh_connection_issues_001",
    "command": "multiple",
    "scenario": "User: Can't SSH into my server",
    "problem": "SSH connection refused, timeout, or authentication failures",
    "solution": "Diagnose SSH issues, fix configuration, setup keys properly",
    "steps": [
      "USER SAYS: 'I can't SSH into my server. Connection refused.'",
      "AGENT: 'Let me help diagnose this. What's the server address?'",
      "USER: '192.168.1.100'",
      "AGENT: 'First, checking if the server is reachable...'",
      "Test ping: ping -c 3 192.168.1.100",
      "If timeout: AGENT: 'Server not responding to ping. Either it's down, or firewall blocks ICMP.'",
      "If responds: AGENT: 'Server is reachable. Checking SSH port...'",
      "Test SSH port: nc -zv 192.168.1.100 22",
      "If refused: AGENT: 'Port 22 is closed or SSH service not running.'",
      "AGENT: 'Do you have physical/console access to the server?'",
      "USER: 'Yes, I'm at the server now'",
      "AGENT: 'Great! Let me check SSH service status...'",
      "Check SSH: sudo systemctl status ssh",
      "Or: sudo systemctl status sshd",
      "If inactive: AGENT: 'SSH service is not running. Starting it...'",
      "Start SSH: sudo systemctl start ssh",
      "Enable autostart: sudo systemctl enable ssh",
      "AGENT: 'SSH service started and enabled for boot.'",
      "Check listening: sudo ss -tulpn | grep :22",
      "AGENT: 'SSH is now listening on port 22. Testing...'",
      "Test local: ssh localhost",
      "If works: AGENT: 'SSH works locally. Checking firewall...'",
      "Check UFW: sudo ufw status",
      "If active: AGENT: 'Firewall is active. Checking if SSH is allowed...'",
      "Check rule: sudo ufw status | grep 22",
      "If not allowed: AGENT: 'SSH not allowed through firewall. Opening port 22...'",
      "Allow SSH: sudo ufw allow 22/tcp",
      "Or: sudo ufw allow ssh",
      "Reload: sudo ufw reload",
      "AGENT: 'Firewall updated. SSH port 22 is open.'",
      "Test from client: AGENT: 'Try connecting now from your client machine.'",
      "USER: 'Now I get: Permission denied (publickey)'",
      "AGENT: 'Authentication issue. Are you using SSH keys or password?'",
      "USER: 'Password, but it's not asking for password'",
      "AGENT: 'Server is configured for key-only auth. Let me check SSH config...'",
      "Check config: sudo cat /etc/ssh/sshd_config | grep -i 'passwordauth\\|pubkey'",
      "AGENT: 'Settings: PasswordAuthentication no, PubkeyAuthentication yes'",
      "AGENT: 'Should I enable password authentication?'",
      "USER: 'Yes, for now'",
      "AGENT: 'Enabling password auth...'",
      "Backup config: sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.backup",
      "Enable password: sudo sed -i 's/PasswordAuthentication no/PasswordAuthentication yes/' /etc/ssh/sshd_config",
      "Also check: sudo sed -i 's/#PasswordAuthentication no/PasswordAuthentication yes/' /etc/ssh/sshd_config",
      "Restart SSH: sudo systemctl restart ssh",
      "AGENT: 'Password authentication enabled. Try connecting now.'",
      "USER: 'Works! But should I use SSH keys instead?'",
      "AGENT: 'Yes, SSH keys are more secure. Let me set that up for you.'",
      "Scenario: SSH key setup",
      "AGENT: 'Setting up SSH key authentication...'",
      "Check existing: ls -la ~/.ssh/id_*.pub",
      "If none: AGENT: 'No SSH key found. Generating one...'",
      "Generate key: ssh-keygen -t ed25519 -C 'user@client-machine'",
      "AGENT: 'Key generated. Now copying to server...'",
      "Copy key: ssh-copy-id user@192.168.1.100",
      "AGENT: 'Enter your password one last time...'",
      "After success: AGENT: 'Key copied! Testing passwordless login...'",
      "Test: ssh user@192.168.1.100 'echo Success'",
      "AGENT: 'Passwordless SSH working! ✓'",
      "AGENT: 'For security, should I disable password authentication?'",
      "USER: 'Yes, make it key-only'",
      "Disable password: sudo sed -i 's/PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config",
      "Restart: sudo systemctl restart ssh",
      "AGENT: 'SSH now requires keys only. More secure! ✓'",
      "Scenario: Different port",
      "USER: 'I want SSH on different port for security'",
      "AGENT: 'Good idea! What port? (Recommend: 2222-9999)'",
      "USER: '2222'",
      "AGENT: 'Changing SSH to port 2222...'",
      "Backup: sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.backup",
      "Change port: sudo sed -i 's/#Port 22/Port 2222/' /etc/ssh/sshd_config",
      "Or: sudo sed -i 's/Port 22/Port 2222/' /etc/ssh/sshd_config",
      "AGENT: 'Opening port 2222 in firewall...'",
      "Allow new: sudo ufw allow 2222/tcp",
      "AGENT: 'Restarting SSH...'",
      "Restart: sudo systemctl restart ssh",
      "Verify: sudo ss -tulpn | grep 2222",
      "AGENT: 'SSH now on port 2222. To connect: ssh -p 2222 user@host'",
      "Test: ssh -p 2222 localhost",
      "AGENT: 'Working! After verifying, you can close port 22:'",
      "Close old: sudo ufw delete allow 22/tcp",
      "Create SSH config: AGENT: 'Creating easy connection aliases...'",
      "Create config: cat > ~/.ssh/config << 'EOF'",
      "Host myserver",
      "  HostName 192.168.1.100",
      "  Port 2222",
      "  User myuser",
      "  IdentityFile ~/.ssh/id_ed25519",
      "",
      "Host *.example.com",
      "  Port 2222",
      "  User admin",
      "EOF",
      "Set permissions: chmod 600 ~/.ssh/config",
      "AGENT: 'Now you can just type: ssh myserver'",
      "Test: ssh myserver 'echo Works!'",
      "AGENT: 'Alias works! ✓'",
      "Create SSH helper scripts: cat > ~/ssh-diagnose.sh << 'EOF'",
      "#!/bin/bash",
      "HOST=\"${1:-localhost}\"",
      "echo '=== SSH Diagnostics ==='",
      "echo ''",
      "echo \"Testing: $HOST\"",
      "echo ''",
      "echo '1. Ping test:'",
      "ping -c 2 $HOST 2>&1 | tail -2",
      "echo ''",
      "echo '2. SSH port (22):'",
      "nc -zv $HOST 22 2>&1",
      "echo ''",
      "echo '3. SSH connection:'",
      "ssh -o ConnectTimeout=5 -o BatchMode=yes $HOST 'echo Connected' 2>&1",
      "echo ''",
      "echo '4. Your SSH keys:'",
      "ls -lh ~/.ssh/id_*",
      "EOF",
      "Make executable: chmod +x ~/ssh-diagnose.sh",
      "Create key manager: cat > ~/ssh-key-manager.sh << 'EOF'",
      "#!/bin/bash",
      "echo '=== SSH Key Manager ==='",
      "echo ''",
      "echo '1. Generate new key'",
      "echo '2. List keys'",
      "echo '3. Copy key to server'",
      "echo '4. Test key authentication'",
      "echo ''",
      "read -p 'Choose (1-4): ' OPT",
      "case $OPT in",
      "  1)",
      "    read -p 'Email/description: ' DESC",
      "    ssh-keygen -t ed25519 -C \"$DESC\"",
      "    ;;",
      "  2)",
      "    ls -lh ~/.ssh/",
      "    echo ''",
      "    cat ~/.ssh/*.pub 2>/dev/null",
      "    ;;",
      "  3)",
      "    read -p 'Server (user@host): ' SERVER",
      "    ssh-copy-id $SERVER",
      "    ;;",
      "  4)",
      "    read -p 'Server (user@host): ' SERVER",
      "    ssh -o BatchMode=yes $SERVER 'echo Key auth works!' 2>&1",
      "    ;;",
      "esac",
      "EOF",
      "Make executable: chmod +x ~/ssh-key-manager.sh",
      "Add SSH aliases: cat >> ~/.bashrc << 'EOF'",
      "# SSH helpers",
      "alias ssh-diagnose='~/ssh-diagnose.sh'",
      "alias ssh-keys='~/ssh-key-manager.sh'",
      "alias ssh-config='vim ~/.ssh/config'",
      "alias ssh-test='ssh -v'",
      "EOF",
      "Source: source ~/.bashrc",
      "Create quick connect script: cat > ~/quick-ssh.sh << 'EOF'",
      "#!/bin/bash",
      "if [ -z \"$1\" ]; then",
      "  echo 'Saved SSH connections:'",
      "  grep '^Host ' ~/.ssh/config 2>/dev/null | awk '{print \"  \" $2}'",
      "  echo ''",
      "  echo 'Usage: ./quick-ssh.sh <host>'",
      "  exit 0",
      "fi",
      "ssh \"$1\"",
      "EOF",
      "Make executable: chmod +x ~/quick-ssh.sh",
      "Security hardening: AGENT: 'Want me to add extra SSH security?'",
      "USER: 'Yes'",
      "AGENT: 'Applying security hardening...'",
      "Backup: sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.backup",
      "Disable root: echo 'PermitRootLogin no' | sudo tee -a /etc/ssh/sshd_config",
      "Max attempts: echo 'MaxAuthTries 3' | sudo tee -a /etc/ssh/sshd_config",
      "Login grace: echo 'LoginGraceTime 30' | sudo tee -a /etc/ssh/sshd_config",
      "Restart: sudo systemctl restart ssh",
      "AGENT: 'Security hardening applied:'",
      "AGENT: '✓ Root login disabled'",
      "AGENT: '✓ Max 3 auth attempts'",
      "AGENT: '✓ 30 second login timeout'",
      "Final summary: AGENT: 'SSH fully configured! Summary:'",
      "AGENT: ''",
      "AGENT: '✓ SSH service running and enabled'",
      "AGENT: '✓ Firewall allows SSH on port 2222'",
      "AGENT: '✓ SSH key authentication setup'",
      "AGENT: '✓ Password auth disabled (key-only)'",
      "AGENT: '✓ Security hardening applied'",
      "AGENT: ''",
      "AGENT: 'Connection methods:'",
      "AGENT: '1. ssh myserver (using alias)'",
      "AGENT: '2. ssh -p 2222 user@192.168.1.100'",
      "AGENT: '3. ./quick-ssh.sh myserver'",
      "AGENT: ''",
      "AGENT: 'Tools created:'",
      "AGENT: '- ~/ssh-diagnose.sh (troubleshoot)'",
      "AGENT: '- ~/ssh-key-manager.sh (manage keys)'",
      "AGENT: '- ~/quick-ssh.sh (quick connect)'",
      "AGENT: '- ~/.ssh/config (connection profiles)'",
      "AGENT: ''",
      "AGENT: 'SSH is secure and working perfectly! ✓'"
    ],
    "commands": ["ssh", "ping", "nc", "systemctl", "ss", "ufw", "ssh-keygen", "ssh-copy-id", "sed", "cat", "chmod", "grep", "tee"],
    "packages": {
      "debian_ubuntu": ["openssh-server", "openssh-client", "netcat-openbsd", "ufw"],
      "arch": ["openssh", "gnu-netcat", "ufw"]
    },
    "related_commands": ["ssh", "scp", "sftp", "ssh-keygen", "ssh-copy-id"],
    "complexity": "intermediate",
    "tags": ["ssh", "remote-access", "authentication", "security", "networking", "troubleshooting", "real-world", "ai-agent"]
  },
  {
    "id": "scenario_security_audit_001",
    "command": "multiple",
    "scenario": "User: Is my system secure? Check for vulnerabilities",
    "problem": "User wants security audit and hardening recommendations",
    "solution": "Perform security scan, identify issues, apply hardening",
    "steps": [
      "USER SAYS: 'I'm worried about security. Can you check if my system is safe?'",
      "AGENT: 'Absolutely! Let me run a comprehensive security audit...'",
      "AGENT: 'This will check: open ports, weak permissions, updates, firewall, and more.'",
      "Phase 1: Open ports check",
      "AGENT: 'Phase 1: Checking open ports...'",
      "Check listening: sudo ss -tulpn",
      "AGENT: 'Open ports found:'",
      "Format: sudo ss -tulpn | grep LISTEN | awk '{print $5}' | cut -d: -f2 | sort -u",
      "AGENT: '- Port 22 (SSH) - Expected ✓'",
      "AGENT: '- Port 80 (HTTP) - Expected ✓'",
      "AGENT: '- Port 3306 (MySQL) - WARNING: Exposed to network!'",
      "USER: 'Is that bad?'",
      "AGENT: 'MySQL should only listen on localhost. Let me check...'",
      "Check binding: sudo ss -tulpn | grep 3306",
      "AGENT: 'MySQL is listening on 0.0.0.0:3306 (all interfaces). Security risk!'",
      "AGENT: 'Should I restrict it to localhost only?'",
      "USER: 'Yes, please'",
      "Fix MySQL: sudo sed -i 's/bind-address.*/bind-address = 127.0.0.1/' /etc/mysql/mysql.conf.d/mysqld.cnf",
      "Restart: sudo systemctl restart mysql",
      "Verify: sudo ss -tulpn | grep 3306",
      "AGENT: 'Fixed! MySQL now only listens on 127.0.0.1 (localhost). ✓'",
      "Phase 2: Firewall check",
      "AGENT: 'Phase 2: Checking firewall...'",
      "Check UFW: sudo ufw status",
      "If inactive: AGENT: 'WARNING: Firewall is disabled! Your system is exposed.'",
      "AGENT: 'Should I enable firewall with safe defaults?'",
      "USER: 'Yes'",
      "Enable: sudo ufw default deny incoming",
      "Allow SSH: sudo ufw allow 22/tcp",
      "Allow HTTP: sudo ufw allow 80/tcp",
      "Allow HTTPS: sudo ufw allow 443/tcp",
      "Enable firewall: sudo ufw --force enable",
      "AGENT: 'Firewall enabled! Default: deny all incoming, allow outgoing. ✓'",
      "Phase 3: System updates",
      "AGENT: 'Phase 3: Checking for security updates...'",
      "Check updates (Ubuntu): sudo apt update && apt list --upgradable | grep -i security",
      "Check updates (Arch): sudo pacman -Sy && checkupdates",
      "AGENT: 'Found 15 security updates available!'",
      "AGENT: 'Should I install them?'",
      "USER: 'Yes'",
      "Update (Ubuntu): sudo apt upgrade -y",
      "Update (Arch): sudo pacman -Syu --noconfirm",
      "AGENT: 'Security updates installed. System up to date. ✓'",
      "Phase 4: User accounts",
      "AGENT: 'Phase 4: Checking user accounts...'",
      "List users: cat /etc/passwd | grep -v nologin | grep -v false | awk -F: '{print $1}'",
      "AGENT: 'User accounts with login access:'",
      "Show: awk -F: '$7 !~ /nologin|false/ {print $1}' /etc/passwd",
      "AGENT: '- root'",
      "AGENT: '- youruser'",
      "AGENT: '- olduser (WARNING: Inactive for 200 days)'",
      "Check last login: lastlog | grep olduser",
      "AGENT: 'olduser hasn't logged in since 200 days ago. Remove?'",
      "USER: 'Yes'",
      "Disable: sudo usermod -L olduser",
      "AGENT: 'Account locked. You can delete it with: sudo userdel olduser'",
      "Phase 5: File permissions",
      "AGENT: 'Phase 5: Checking sensitive file permissions...'",
      "Check SSH: ls -la ~/.ssh/",
      "If 644: AGENT: 'WARNING: ~/.ssh/id_rsa has wrong permissions (should be 600)'",
      "Fix: chmod 600 ~/.ssh/id_rsa",
      "Check config: ls -la ~/.ssh/config",
      "Fix: chmod 600 ~/.ssh/config",
      "Check sudoers: ls -l /etc/sudoers",
      "Should be: 0440 (r--r-----)",
      "AGENT: 'SSH key permissions fixed. ✓'",
      "Phase 6: World-writable files",
      "AGENT: 'Phase 6: Searching for world-writable files...'",
      "Find writable: sudo find /home -type f -perm -002 2>/dev/null | head -20",
      "AGENT: 'Found world-writable files (security risk):'",
      "List: sudo find /home -type f -perm -002 -ls 2>/dev/null | head -5",
      "AGENT: 'Should I fix these permissions?'",
      "USER: 'Yes'",
      "Fix: sudo find /home -type f -perm -002 -exec chmod o-w {} \\;",
      "AGENT: 'World-writable permissions removed. ✓'",
      "Phase 7: SUID binaries",
      "AGENT: 'Phase 7: Checking SUID/SGID binaries...'",
      "Find SUID: sudo find / -perm -4000 -type f 2>/dev/null",
      "AGENT: 'SUID binaries found (run with elevated privileges):'",
      "Count: sudo find / -perm -4000 -type f 2>/dev/null | wc -l",
      "AGENT: '47 SUID binaries - normal for system'",
      "Save baseline: sudo find / -perm -4000 -type f 2>/dev/null > ~/.suid-baseline",
      "AGENT: 'Baseline saved. Run again later to detect new SUID files.'",
      "Phase 8: Failed login attempts",
      "AGENT: 'Phase 8: Checking for suspicious login attempts...'",
      "Check auth log: sudo grep 'Failed password' /var/log/auth.log | tail -20",
      "Count: sudo grep 'Failed password' /var/log/auth.log | wc -l",
      "AGENT: 'Found 127 failed login attempts!'",
      "Show IPs: sudo grep 'Failed password' /var/log/auth.log | grep -oP 'from \\K[0-9.]+' | sort | uniq -c | sort -rn | head -10",
      "AGENT: 'Top attacking IPs:'",
      "AGENT: '- 54 attempts from 203.0.113.42'",
      "AGENT: '- 31 attempts from 198.51.100.87'",
      "AGENT: 'Should I install fail2ban to auto-block attackers?'",
      "USER: 'Yes'",
      "Install: sudo apt install fail2ban || sudo pacman -S fail2ban",
      "Enable: sudo systemctl enable --now fail2ban",
      "Check: sudo fail2ban-client status sshd",
      "AGENT: 'Fail2ban installed and monitoring SSH. Auto-blocks after 5 failed attempts. ✓'",
      "Create security report: AGENT: 'Creating security report...'",
      "Create report: cat > ~/security-audit-$(date +%Y%m%d).txt << 'EOF'",
      "Security Audit Report",
      "Date: $(date)",
      "",
      "=== Summary ===",
      "✓ Open ports reviewed and secured",
      "✓ Firewall enabled and configured",
      "✓ Security updates installed",
      "✓ User accounts audited",
      "✓ File permissions fixed",
      "✓ World-writable files secured",
      "✓ SUID baseline created",
      "✓ Fail2ban installed",
      "",
      "=== Open Ports ===",
      "$(sudo ss -tulpn | grep LISTEN)",
      "",
      "=== Firewall Rules ===",
      "$(sudo ufw status)",
      "",
      "=== User Accounts ===",
      "$(awk -F: '$7 !~ /nologin|false/ {print $1}' /etc/passwd)",
      "",
      "=== Failed Login Attempts (Last 24h) ===",
      "$(sudo grep 'Failed password' /var/log/auth.log | tail -10)",
      "EOF",
      "AGENT: 'Report saved to ~/security-audit-$(date +%Y%m%d).txt'",
      "Create security checker: cat > ~/security-check.sh << 'EOF'",
      "#!/bin/bash",
      "echo '=== Quick Security Check ==='",
      "echo ''",
      "echo '1. Firewall:'",
      "sudo ufw status | head -5",
      "echo ''",
      "echo '2. Open ports:'",
      "sudo ss -tulpn | grep LISTEN | wc -l",
      "echo ' ports listening'",
      "echo ''",
      "echo '3. Security updates:'",
      "if command -v apt &>/dev/null; then",
      "  apt list --upgradable 2>/dev/null | grep -i security | wc -l",
      "elif command -v pacman &>/dev/null; then",
      "  checkupdates | wc -l",
      "fi",
      "echo ' security updates available'",
      "echo ''",
      "echo '4. Failed logins (24h):'",
      "sudo grep 'Failed password' /var/log/auth.log 2>/dev/null | grep \"$(date +'%b %e')\" | wc -l",
      "echo ' failed attempts today'",
      "echo ''",
      "echo '5. Fail2ban status:'",
      "sudo fail2ban-client status 2>/dev/null | grep 'Number of jail' || echo 'Not installed'",
      "EOF",
      "Make executable: chmod +x ~/security-check.sh",
      "Create hardening script: cat > ~/security-harden.sh << 'EOF'",
      "#!/bin/bash",
      "echo '=== System Hardening ==='",
      "echo ''",
      "echo 'This will:'",
      "echo '1. Enable firewall'",
      "echo '2. Install fail2ban'",
      "echo '3. Disable root SSH'",
      "echo '4. Fix file permissions'",
      "echo '5. Enable automatic updates'",
      "echo ''",
      "read -p 'Continue? (y/n): ' CONFIRM",
      "[ \"$CONFIRM\" != 'y' ] && exit 0",
      "echo ''",
      "echo 'Step 1: Firewall...'",
      "sudo ufw default deny incoming",
      "sudo ufw allow 22/tcp",
      "sudo ufw --force enable",
      "echo 'Step 2: Fail2ban...'",
      "sudo apt install -y fail2ban 2>/dev/null || sudo pacman -S --noconfirm fail2ban",
      "sudo systemctl enable --now fail2ban",
      "echo 'Step 3: SSH hardening...'",
      "sudo sed -i 's/PermitRootLogin yes/PermitRootLogin no/' /etc/ssh/sshd_config",
      "sudo systemctl restart ssh",
      "echo 'Step 4: Permissions...'",
      "chmod 700 ~/.ssh 2>/dev/null",
      "chmod 600 ~/.ssh/* 2>/dev/null",
      "echo 'Step 5: Auto-updates...'",
      "sudo apt install -y unattended-upgrades 2>/dev/null",
      "echo ''",
      "echo '✓ Hardening complete!'",
      "EOF",
      "Make executable: chmod +x ~/security-harden.sh",
      "Add aliases: cat >> ~/.bashrc << 'EOF'",
      "# Security helpers",
      "alias security-check='~/security-check.sh'",
      "alias security-harden='~/security-harden.sh'",
      "alias ports='sudo ss -tulpn | grep LISTEN'",
      "alias firewall='sudo ufw status'",
      "EOF",
      "Source: source ~/.bashrc",
      "Final summary: AGENT: 'Security audit complete! Summary:'",
      "AGENT: ''",
      "AGENT: '✓ MySQL restricted to localhost'",
      "AGENT: '✓ Firewall enabled with safe rules'",
      "AGENT: '✓ All security updates installed'",
      "AGENT: '✓ Inactive user accounts disabled'",
      "AGENT: '✓ File permissions secured'",
      "AGENT: '✓ Fail2ban protecting against attacks'",
      "AGENT: ''",
      "AGENT: 'Security Score: 8.5/10 (Good!)'",
      "AGENT: ''",
      "AGENT: 'Recommendations:'",
      "AGENT: '1. Run security-check weekly'",
      "AGENT: '2. Review fail2ban logs monthly'",
      "AGENT: '3. Keep system updated'",
      "AGENT: '4. Monitor auth logs for suspicious activity'",
      "AGENT: ''",
      "AGENT: 'Tools created:'",
      "AGENT: '- ~/security-check.sh (quick scan)'",
      "AGENT: '- ~/security-harden.sh (auto-harden)'",
      "AGENT: '- ~/security-audit-$(date +%Y%m%d).txt (full report)'",
      "AGENT: ''",
      "AGENT: 'Your system is now much more secure! ✓'"
    ],
    "commands": ["ss", "ufw", "apt", "pacman", "sed", "systemctl", "chmod", "cat", "find", "grep", "lastlog", "fail2ban-client", "awk", "wc"],
    "packages": {
      "debian_ubuntu": ["ufw", "fail2ban", "unattended-upgrades"],
      "arch": ["ufw", "fail2ban"]
    },
    "related_commands": ["ufw", "iptables", "fail2ban", "ss", "netstat", "chmod"],
    "complexity": "advanced",
    "tags": ["security", "audit", "hardening", "firewall", "permissions", "intrusion-detection", "real-world", "ai-agent"]
  }
]
